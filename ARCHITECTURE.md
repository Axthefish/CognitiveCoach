# CognitiveCoach æ¶æ„æ–‡æ¡£

> åŸºäº AI çš„è®¤çŸ¥å­¦ä¹ åŠ©æ‰‹ï¼Œé‡‡ç”¨"**é€šç”¨æ¡†æ¶ + ä¸ªæ€§åŒ–è¡¥å……**"ç†å¿µ

**å½“å‰ç‰ˆæœ¬**: V2.0  
**æœ€åæ›´æ–°**: 2025-01-15  

---

## ğŸ‰ V2.0 æ¶æ„ (Current)

### æ ¸å¿ƒç†å¿µå˜æ›´

**ä»çº¿æ€§æµç¨‹åˆ°ç›®çš„é©±åŠ¨**

| ç»´åº¦ | V1 (Legacy) | V2 (Current) |
|------|------------|-------------|
| **é˜¶æ®µæ•°** | 5ä¸ªé˜¶æ®µ (S0-S4) | 3ä¸ªé˜¶æ®µ (Stage 0-2) |
| **æ ¸å¿ƒç†å¿µ** | çº¿æ€§æ¸è¿›å¼ | é€šç”¨æ¡†æ¶ + ä¸ªæ€§åŒ– |
| **äº¤äº’æ–¹å¼** | è¡¨å• + å›¾è¡¨ | å¯¹è¯ + å¯è§†åŒ– |
| **æƒé‡ç³»ç»Ÿ** | æ—  | åŸºäºç›®çš„çš„åŠ¨æ€æƒé‡ (0-100%) |
| **è§†è§‰å‘ˆç°** | Mermaid æµç¨‹å›¾ | ECharts é€»è¾‘æµç¨‹å›¾ |
| **ä¸ªæ€§åŒ–** | æœ€åé˜¶æ®µ | è´¯ç©¿å…¨æµç¨‹ |

### V2 æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 0: ç›®çš„æ¾„æ¸…ä¸é—®é¢˜åŸŸæ¡†å®š                        â”‚
â”‚  - å¯¹è¯å¼äº¤äº’ (ChatBox)                               â”‚
â”‚  - å¤šè½®è¿½é—®ä¸ç¡®è®¤                                     â”‚
â”‚  - è¾“å‡º: PurposeDefinition                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 1: é€šç”¨æ¡†æ¶ç”Ÿæˆä¸å¯è§†åŒ–                        â”‚
â”‚  - åŸºäºç›®çš„ç”Ÿæˆå¸¦æƒé‡çš„æ¡†æ¶                           â”‚
â”‚  - æƒé‡è®¡ç®—: necessityÃ—0.4 + impactÃ—0.3 + timeROIÃ—0.3â”‚
â”‚  - é€»è¾‘æµç¨‹å›¾å±•ç¤º (ECharts)                          â”‚
â”‚  - Pause æœºåˆ¶ï¼ˆç»™ç”¨æˆ·æ€è€ƒæ—¶é—´ï¼‰                       â”‚
â”‚  - è¾“å‡º: UniversalFramework                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 2: åŠ¨æ€ä¿¡æ¯æ”¶é›†ä¸ä¸ªæ€§åŒ–æ–¹æ¡ˆç”Ÿæˆ                â”‚
â”‚  - å·¦ä¾§: ChatBoxï¼ˆåŠ¨æ€é—®é¢˜ï¼‰                         â”‚
â”‚  - å³ä¾§: LogicFlowChartï¼ˆå®æ—¶æ›´æ–°ï¼‰                  â”‚
â”‚  - åˆ†æç¼ºå¤±ä¿¡æ¯ â†’ æé—® â†’ è°ƒæ•´æƒé‡ â†’ ç”Ÿæˆæ–¹æ¡ˆ         â”‚
â”‚  - è¾“å‡º: PersonalizedPlan                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### V2 æ ¸å¿ƒç‰¹æ€§

#### 1. æƒé‡è®¡ç®—ç³»ç»Ÿ

```typescript
// ä¸‰ç»´åº¦è¯„ä¼°
weight = (necessity Ã— 0.4) + (impact Ã— 0.3) + (timeROI Ã— 0.3)

// å››çº§é¢œè‰²ç¼–ç 
æ·±è“è‰² (90-100%): æ ¸å¿ƒå¿…ä¿®
è“è‰²   (70-89%):  é‡è¦æ¨è
æµ…è“è‰² (50-69%):  å¯é€‰å¢å¼º
ç°è‰²   (<50%):    ä½ä¼˜å…ˆçº§
```

#### 2. æ–°æ–‡ä»¶ç»“æ„

```
V2 æ–°å¢æ–‡ä»¶ (~24ä¸ª, ~3300è¡Œ):
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ types-v2.ts              # V2 ç±»å‹ç³»ç»Ÿ
â”‚   â”œâ”€â”€ store-v2.ts              # V2 çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ weight-calculator.ts     # æƒé‡è®¡ç®—ç®—æ³•
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ stage0-prompts.ts
â”‚       â”œâ”€â”€ stage1-prompts.ts
â”‚       â”œâ”€â”€ stage2-prompts.ts
â”‚       â””â”€â”€ testing/             # Promptæµ‹è¯•å¥—ä»¶
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ stage0-view.tsx          # ç›®çš„æ¾„æ¸…è§†å›¾
â”‚   â”œâ”€â”€ stage1-view.tsx          # æ¡†æ¶å±•ç¤ºè§†å›¾
â”‚   â”œâ”€â”€ stage2-view.tsx          # ä¸ªæ€§åŒ–è§†å›¾
â”‚   â”œâ”€â”€ chat-interface/          # å¯¹è¯ç»„ä»¶ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ logic-flow-chart/        # é€»è¾‘æµç¨‹å›¾ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ stage0-service.ts        # ç›®çš„æ¾„æ¸…æœåŠ¡
â”‚   â”œâ”€â”€ stage1-service.ts        # æ¡†æ¶ç”ŸæˆæœåŠ¡
â”‚   â””â”€â”€ stage2-service.ts        # ä¸ªæ€§åŒ–æœåŠ¡
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ client-page-v2.tsx       # V2 ä¸»é¡µé¢
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ stage0/route.ts
â”‚       â”œâ”€â”€ stage1/route.ts
â”‚       â””â”€â”€ stage2/route.ts
â”‚
â””â”€â”€ æ–‡æ¡£
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md
    â””â”€â”€ QUICKSTART_V2.md
```

#### 3. V2 æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â†“
Stage0Service.processInitialInput()
  â†“
å¤šè½®å¯¹è¯ (å¯¹è¯çŠ¶æ€æœº)
  â†“
PurposeDefinition (ç½®ä¿¡åº¦ > 0.8)
  â†“
Stage1Service.generateFramework()
  â†“
AIç”Ÿæˆæ¡†æ¶ + æƒé‡è®¡ç®—
  â†“
UniversalFramework (å¸¦æƒé‡çš„èŠ‚ç‚¹å›¾)
  â†“
Pauseï¼ˆç”¨æˆ·æ€è€ƒï¼‰
  â†“
Stage2Service.analyzeMissingInfo()
  â†“
ç”ŸæˆåŠ¨æ€é—®é¢˜ (3-5ä¸ª)
  â†“
æ”¶é›†ç”¨æˆ·å›ç­”
  â†“
Stage2Service.generatePersonalizedPlan()
  â†“
è°ƒæ•´æ¡†æ¶æƒé‡ + ç”Ÿæˆè¡ŒåŠ¨æ­¥éª¤
  â†“
PersonalizedPlan (å®Œæ•´æ–¹æ¡ˆ)
```

#### 4. V2 API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/stage0` | POST | ç›®çš„æ¾„æ¸…ï¼ˆæ”¯æŒ initial/continue/confirmï¼‰ |
| `/api/stage1` | POST | ç”Ÿæˆé€šç”¨æ¡†æ¶ |
| `/api/stage2` | POST | åˆ†æç¼ºå¤±ä¿¡æ¯ (analyze) / ç”Ÿæˆæ–¹æ¡ˆ (generate) |
| `/api/health` | GET | å¥åº·æ£€æŸ¥ |

### V2 æŠ€æœ¯äº®ç‚¹

1. **å¯¹è¯çŠ¶æ€æœº** (Stage 0)
   - å¤šè½®è¿½é—®ç­–ç•¥
   - ç½®ä¿¡åº¦è¯„ä¼°
   - åŠ¨æ€ç¡®è®¤æœºåˆ¶

2. **æƒé‡è®¡ç®—ç®—æ³•** (Stage 1)
   - ä¸‰ç»´åº¦è¯„ä¼°ï¼ˆå¿…è¦æ€§ã€å½±å“åŠ›ã€æ—¶é—´ROIï¼‰
   - æƒé‡åˆ†å¸ƒéªŒè¯
   - è‡ªåŠ¨é¢œè‰²æ˜ å°„

3. **åŠ¨æ€é—®é¢˜ç”Ÿæˆ** (Stage 2)
   - åŸºäºæ¡†æ¶åˆ†æç¼ºå¤±ä¿¡æ¯
   - 4ç§é—®é¢˜ç±»å‹ï¼ˆbaseline, resource, context, motivationï¼‰
   - å½±å“åŠ›æ’åº

4. **å®æ—¶æ¡†æ¶æ›´æ–°** (Stage 2)
   - åˆ†å±å¸ƒå±€
   - å·¦ä¾§å¯¹è¯ + å³ä¾§å¯è§†åŒ–
   - åŸºäºç”¨æˆ·å›ç­”åŠ¨æ€è°ƒæ•´æƒé‡

### è¿ç§»è¯´æ˜

**ä» V1 è¿ç§»åˆ° V2**:
- âœ… V1 ä»£ç å·²å®Œæ•´ä¿ç•™ï¼ˆä¸‹æ–‡ï¼‰
- âœ… V2 ä½œä¸ºé»˜è®¤ç‰ˆæœ¬ï¼ˆ`app/page.tsx` ä½¿ç”¨ `ClientPageV2`ï¼‰
- âœ… V1 å’Œ V2 å¯å…±å­˜ï¼ˆé€šè¿‡åˆ‡æ¢å…¥å£æ–‡ä»¶ï¼‰
- âš ï¸ V1 Service/View/Prompts å·²ç§»é™¤ï¼Œä»…ä¿ç•™æ¶æ„æ–‡æ¡£ç”¨äºå‚è€ƒ

---

## ğŸ“‹ V1 æ¶æ„æ–‡æ¡£ (Legacy - ä»…ä¾›å‚è€ƒ)

> **æ³¨æ„**: ä»¥ä¸‹å†…å®¹ä¸º V1 æ¶æ„çš„å®Œæ•´æ–‡æ¡£ï¼Œä¿ç•™ç”¨äºæŠ€æœ¯å‚è€ƒå’Œç‰ˆæœ¬å¯¹æ¯”ã€‚  
> **å½“å‰ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ V2 æ¶æ„**ã€‚

**V1 ç‰ˆæœ¬**: 1.10  
**æœ€åæ›´æ–°**: 2025-10-09  
**ä»£ç æ¸…ç†ä¼˜åŒ–**: 
- 2025-10-09 v1.1ï¼ˆåˆ é™¤æ­»ä»£ç ã€ç»Ÿä¸€é”™è¯¯å¤„ç†ã€API middlewareæŠ½å–ï¼‰
- 2025-10-09 v1.2ï¼ˆä¿®å¤ç¼ºå¤±ä¾èµ–ã€ç»Ÿä¸€CORSé€»è¾‘ã€æ¸…ç†æœªä½¿ç”¨ä»£ç ã€ç»Ÿä¸€æ—¥å¿—è°ƒç”¨ï¼‰
- 2025-10-09 v1.3ï¼ˆä¿®å¤ç¼ºå¤±çš„ network-utilsä¾èµ–ã€ç»Ÿä¸€CORSé€»è¾‘ã€æ¸…ç†æœªä½¿ç”¨ä»£ç ï¼‰
- 2025-10-09 v1.4ï¼ˆä¿®å¤æ‰€æœ‰TypeScript/ESLinté”™è¯¯ã€æå–é‡å¤é€»è¾‘ã€åˆ é™¤æœªä½¿ç”¨ç»„ä»¶ï¼‰
- 2025-10-09 v1.5ï¼ˆåˆ é™¤æœªä½¿ç”¨ä»£ç ã€ç®€åŒ–é€Ÿç‡é™åˆ¶ã€ä¼˜åŒ–å·¥å…·å‡½æ•°ç»„ç»‡ã€æå–Serviceå±‚é‡å¤é€»è¾‘ï¼‰
- 2025-10-09 v1.6ï¼ˆ**å®Œå…¨ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿã€ç»Ÿä¸€fetchå®ç°**ï¼‰
- 2025-10-09 v1.7ï¼ˆ**Serviceå±‚éªŒè¯è¾…åŠ©å‡½æ•°æå–ã€ä¼˜åŒ–ç±»å‹å®‰å…¨ã€ESLintä¼˜åŒ–**ï¼‰
- 2025-10-09 v1.8ï¼ˆ**ç»„ä»¶æ¨¡å—åŒ–æ‹†åˆ†ã€æ€§èƒ½ä¼˜åŒ–ã€ç§»é™¤é™æ€èµ„æºå¼•ç”¨**ï¼‰
- 2025-10-09 v1.9ï¼ˆ**åŠ¨ç”»ç³»ç»Ÿé‡æ„ã€LoadingOverlayç®€åŒ–ã€æ¸…ç†å¤æ‚ç»„ä»¶**ï¼‰
- 2025-10-09 v1.10ï¼ˆ**ä¿®æ­£@deprecatedæ ‡è®°ã€æå–QAå¤„ç†é€»è¾‘ã€æ¶æ„æ–‡æ¡£ä¸€è‡´æ€§**ï¼‰

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **å‰ç«¯**: Next.js 15.2.4 (App Router) + React 19.0.0
- **è¯­è¨€**: TypeScript 5.x
- **çŠ¶æ€ç®¡ç†**: Zustand 5.0.7
- **æ ·å¼**: Tailwind CSS 4.x

### AI ä¸éªŒè¯
- **AI æœåŠ¡**: Google Gemini API (gemini-2.5-pro / gemini-2.5-flash-lite)
- **Schema éªŒè¯**: Zod 4.0.17

### å¯è§†åŒ–
- **æµç¨‹å›¾**: Mermaid 11.9.0
- **æ•°æ®å›¾è¡¨**: ECharts 5.6.0 + ECharts-GL 2.0.9

### UI ç»„ä»¶
- **åŸºç¡€ç»„ä»¶**: Radix UI (Accordion, Checkbox, Label, Tabs)
- **å·¥å…·åº“**: clsx, class-variance-authority, tailwind-merge, lucide-react

### æ€§èƒ½ä¼˜åŒ–
- **LRU ç¼“å­˜**: lru-cache 10.1.0

---

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ app/                        # Next.js App Router
â”‚   â”œâ”€â”€ api/                   # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ coach/            # æ ‡å‡† JSON API
â”‚   â”‚   â”œâ”€â”€ coach-stream/     # æµå¼ SSE API
â”‚   â”‚   â””â”€â”€ health/           # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx              # æœåŠ¡ç«¯å…¥å£
â”‚   â”œâ”€â”€ client-page.tsx       # å®¢æˆ·ç«¯ä¸»é¡µé¢
â”‚   â””â”€â”€ globals.css           # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/                # React ç»„ä»¶
â”‚   â”œâ”€â”€ s0-intent-view.tsx                    # S0: ç›®æ ‡æ ¡å‡†
â”‚   â”œâ”€â”€ s1-knowledge-framework-view.tsx       # S1: çŸ¥è¯†æ¡†æ¶
â”‚   â”œâ”€â”€ s2-system-dynamics-view.tsx           # S2: ç³»ç»ŸåŠ¨åŠ›å­¦
â”‚   â”œâ”€â”€ s3-action-plan-view.tsx               # S3: è¡ŒåŠ¨è®¡åˆ’
â”‚   â”œâ”€â”€ s4-autonomous-operation-view.tsx      # S4: è‡ªä¸»è¿è¥
â”‚   â”œâ”€â”€ cognitive-stream-animator.tsx         # æµå¼åŠ¨ç”»æ§åˆ¶å™¨ï¼ˆé‡æ„ä¸º183è¡Œï¼‰
â”‚   â”œâ”€â”€ error-boundary.tsx                    # é”™è¯¯è¾¹ç•Œ
â”‚   â”œâ”€â”€ goal-templates.tsx                    # ç›®æ ‡æ¨¡æ¿é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ hydration-monitor.tsx                 # Hydration ç›‘æ§
â”‚   â”œâ”€â”€ hooks/                                # ç»„ä»¶å±‚ Hooks
â”‚   â”‚   â”œâ”€â”€ useStreamState.ts                 # æµå¼çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useStreamConnection.ts            # æµå¼è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useNetworkStatus.ts               # ç½‘ç»œçŠ¶æ€ç›‘æ§
â”‚   â”‚   â””â”€â”€ useLoadingProgress.ts             # åŠ è½½è¿›åº¦ç®¡ç†
â”‚   â”œâ”€â”€ utils/                                # ç»„ä»¶å±‚å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ streamMessageProcessor.ts         # æµå¼æ¶ˆæ¯å¤„ç†
â”‚   â””â”€â”€ ui/                                   # é€šç”¨ UI ç»„ä»¶
â”‚       â”œâ”€â”€ button.tsx, card.tsx, input.tsx   # åŸºç¡€ç»„ä»¶
â”‚       â”œâ”€â”€ loading-overlay.tsx               # åŠ è½½é®ç½©ï¼ˆé‡æ„ç‰ˆï¼Œ~150è¡Œï¼‰
â”‚       â”œâ”€â”€ loading-animation.tsx             # ç»Ÿä¸€åŠ è½½åŠ¨ç”»
â”‚       â”œâ”€â”€ interactive-mermaid.tsx           # äº¤äº’å¼ Mermaid
â”‚       â”œâ”€â”€ echarts-system-graph.tsx          # ECharts ç³»ç»Ÿå›¾
â”‚       â””â”€â”€ ...                               # å…¶ä»– UI ç»„ä»¶
â”‚
â”œâ”€â”€ lib/                       # æ ¸å¿ƒåº“å’Œå·¥å…·
â”‚   â”œâ”€â”€ types.ts              # æ ¸å¿ƒä¸šåŠ¡ç±»å‹å®šä¹‰ï¼ˆå”¯ä¸€æ¥æºï¼šFSMStateã€UserContextã€ConversationMessageï¼‰
â”‚   â”œâ”€â”€ schemas.ts            # Zod Schema å®šä¹‰
â”‚   â”œâ”€â”€ api-types.ts          # API ç±»å‹å®šä¹‰ï¼ˆAPIå±‚ä¸“ç”¨ï¼šè¯·æ±‚/å“åº”ã€Payloadã€æµå¼æ¶ˆæ¯ï¼‰
â”‚   â”œâ”€â”€ store.ts              # Zustand çŠ¶æ€ç®¡ç†ï¼ˆä½¿ç”¨ types.ts çš„ç±»å‹ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ gemini-config.ts      # Gemini AI é…ç½®
â”‚   â”œâ”€â”€ ai-retry-handler.ts   # AI è°ƒç”¨æ™ºèƒ½é‡è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ prompts/              # Prompt ç®¡ç†ï¼ˆç»Ÿä¸€ç³»ç»Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ s0-prompts.ts     # S0 ç›®æ ‡ç²¾ç‚¼ Prompts
â”‚   â”‚   â”œâ”€â”€ s1-prompts.ts     # S1 çŸ¥è¯†æ¡†æ¶ Prompts
â”‚   â”‚   â”œâ”€â”€ s2-prompts.ts     # S2 ç³»ç»ŸåŠ¨åŠ›å­¦ Prompts
â”‚   â”‚   â”œâ”€â”€ s3-prompts.ts     # S3 è¡ŒåŠ¨è®¡åˆ’ Prompts
â”‚   â”‚   â””â”€â”€ s4-prompts.ts     # S4 è¿›åº¦åˆ†æ Prompts
â”‚   â”‚
â”‚   â”œâ”€â”€ framework-utils.ts    # æ¡†æ¶å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ s2-utils.ts           # S2 é˜¶æ®µä¸“ç”¨å·¥å…·ï¼ˆæ„å›¾æå–ã€æ æ†ç‚¹è®¡ç®—ã€æ ¸å¿ƒè·¯å¾„ï¼‰
â”‚   â”œâ”€â”€ service-utils.ts      # Service å±‚å…±äº«å·¥å…·ï¼ˆSchema éªŒè¯é”™è¯¯å¤„ç† + é€šç”¨éªŒè¯è¾…åŠ©å‡½æ•°ï¼‰
â”‚   â”œâ”€â”€ cache-service.ts      # ç¼“å­˜æœåŠ¡ï¼ˆLRU ç¼“å­˜ï¼‰
â”‚   â”œâ”€â”€ qa.ts                 # è´¨é‡æ£€æŸ¥é—¨æ§
â”‚   â”‚
â”‚   â”œâ”€â”€ app-errors.ts         # é”™è¯¯ç±»å®šä¹‰å’Œä¸šåŠ¡é”™è¯¯å¤„ç†ï¼ˆé«˜çº§æŠ½è±¡ï¼‰
â”‚   â”œâ”€â”€ error-utils.ts        # å“åº”æ ¼å¼åŒ–å·¥å…· + é”™è¯¯æ˜ å°„ï¼ˆmapErrorToUserMessageï¼‰
â”‚   â”œâ”€â”€ schema-error-translator.ts  # Schema é”™è¯¯ç¿»è¯‘
â”‚   â”‚
â”‚   â”œâ”€â”€ api-middleware.ts     # API å…±äº«ä¸­é—´ä»¶ï¼ˆrate limitingã€CORSã€schemaéªŒè¯ã€SSEå¤´ï¼‰
â”‚   â”œâ”€â”€ cors.ts               # CORS é…ç½®
â”‚   â”œâ”€â”€ rate-limit.ts         # é€Ÿç‡é™åˆ¶ï¼ˆå†…å­˜å­˜å‚¨ï¼‰
â”‚   â”œâ”€â”€ logger.ts             # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ env-validator.ts      # ç¯å¢ƒå˜é‡éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ stream-manager.ts     # æµå¼çŠ¶æ€ç®¡ç†ï¼ˆå…¨å±€çŠ¶æ€ã€AbortController ç”Ÿå‘½å‘¨æœŸï¼‰
â”‚   â”œâ”€â”€ streaming-wrapper.ts  # æµå¼åŒ…è£…å™¨ï¼ˆå°† Service åŒ…è£…ä¸º SSE æµã€è¿›åº¦æ¨¡æ‹Ÿï¼‰
â”‚   â”œâ”€â”€ api-fallback.ts       # API é™çº§å¤„ç†
â”‚   â”œâ”€â”€ id-generator.ts       # ID ç”Ÿæˆå™¨ï¼ˆåŒ…å« generateTraceIdï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                # React Hooks
â”‚   â”‚   â””â”€â”€ useStageNavigation.ts  # çŠ¶æ€å¯¼èˆªå’Œè½¬æ¢é€»è¾‘
â”‚   â”‚
â”‚   â”œâ”€â”€ hydration-safe.ts     # Hydration å®‰å…¨å·¥å…·
â”‚   â”œâ”€â”€ loading-tips.ts       # åŠ è½½æç¤º
â”‚   â””â”€â”€ utils.ts              # é€šç”¨å·¥å…·å‡½æ•°ï¼ˆcn ç­‰ï¼‰
â”‚
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ s0-service.ts         # S0: ç›®æ ‡ç²¾ç‚¼æœåŠ¡
â”‚   â”œâ”€â”€ s1-service.ts         # S1: çŸ¥è¯†æ¡†æ¶ç”Ÿæˆ
â”‚   â”œâ”€â”€ s2-service.ts         # S2: ç³»ç»ŸåŠ¨åŠ›å­¦
â”‚   â”œâ”€â”€ s3-service.ts         # S3: è¡ŒåŠ¨è®¡åˆ’
â”‚   â””â”€â”€ s4-service.ts         # S4: è¿›åº¦åˆ†æä¸å’¨è¯¢
â”‚
â”œâ”€â”€ tests/                    # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ setup.ts
â”‚   â””â”€â”€ unit/
â”‚       â”œâ”€â”€ lib/              # åº“å‡½æ•°æµ‹è¯•
â”‚       â””â”€â”€ services/         # æœåŠ¡å±‚æµ‹è¯•
â”‚
â”œâ”€â”€ middleware.ts             # Next.js ä¸­é—´ä»¶
â”œâ”€â”€ next.config.ts            # Next.js é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â”œâ”€â”€ tailwind.config.ts        # Tailwind CSS é…ç½®
â””â”€â”€ package.json              # é¡¹ç›®ä¾èµ–
```

---

## æ ¸å¿ƒæ¶æ„æ¨¡å¼

### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer (Components)              â”‚  React ç»„ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Layer (Routes)                 â”‚  Next.js API Routes
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer (Business Logic)     â”‚  S0-S4 Services
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI Layer (Gemini Integration)      â”‚  AI è°ƒç”¨ + é‡è¯•æœºåˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Utility Layer (Tools & Helpers)    â”‚  å·¥å…·å‡½æ•°ã€ç¼“å­˜ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŸåˆ™**:
- âœ… **å•å‘ä¾èµ–**: ä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚
- âœ… **èŒè´£åˆ†ç¦»**: æ¯å±‚æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- âœ… **å¯æµ‹è¯•æ€§**: æ¯å±‚å¯ç‹¬ç«‹æµ‹è¯•

### 2. API æ¶æ„

é¡¹ç›®æä¾›ä¸¤ç§ API æ¨¡å¼ï¼Œå…±äº«ç»Ÿä¸€çš„ä¸­é—´ä»¶å±‚ï¼š

#### æ ‡å‡† JSON API (`/api/coach`)
```typescript
POST /api/coach
Content-Type: application/json

{
  "action": "generateFramework",
  "payload": { ... }
}

â†’ è¿”å›å®Œæ•´ JSON å“åº”
```

**ç‰¹ç‚¹**:
- åŒæ­¥å¤„ç†
- é€‚ç”¨äºä¸éœ€è¦å®æ—¶åé¦ˆçš„åœºæ™¯
- ç®€å•ç›´æ¥

#### æµå¼ SSE API (`/api/coach-stream`)
```typescript
POST /api/coach-stream
Content-Type: application/json

â†’ è¿”å› Server-Sent Events æµ

äº‹ä»¶ç±»å‹ï¼š
- cognitive_step: è®¤çŸ¥æ­¥éª¤æ›´æ–°
- data_structure: æœ€ç»ˆæ•°æ®ç»“æ„
- error: é”™è¯¯ä¿¡æ¯
- done: å®Œæˆä¿¡å·
```

**ç‰¹ç‚¹**:
- å¼‚æ­¥æµå¼å¤„ç†
- å®æ—¶è¿›åº¦åé¦ˆ
- æä¾›è®¤çŸ¥æ­¥éª¤å¯è§†åŒ–
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

**ç»Ÿä¸€æ¶æ„**: 
- ä¸¤ä¸ª API éƒ½ä½¿ç”¨ç›¸åŒçš„ Service å±‚ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§
- é€šè¿‡ `api-middleware.ts` å…±äº« rate limitingã€CORSã€schema éªŒè¯é€»è¾‘

### 3. Service å±‚è®¾è®¡

æ‰€æœ‰ Service éµå¾ªç»Ÿä¸€æ¨¡å¼ï¼š

```typescript
export class SXService {
  private static instance: SXService;  // å•ä¾‹æ¨¡å¼
  
  static getInstance(): SXService {
    if (!SXService.instance) {
      SXService.instance = new SXService();
    }
    return SXService.instance;
  }
  
  async processTask(payload: Payload): Promise<NextResponse> {
    // 1. æ—¥å¿—è®°å½•
    // 2. æ„å»º Prompt
    // 3. AI è°ƒç”¨ï¼ˆå¸¦é‡è¯•ï¼‰
    // 4. Schema éªŒè¯
    // 5. è´¨é‡æ£€æŸ¥
    // 6. è¿”å›å“åº”
  }
}
```

**ä¼˜åŠ¿**:
- âœ… ç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç†
- âœ… å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- âœ… æ”¯æŒæ ‡å‡†å’Œæµå¼ä¸¤ç§ API

### 4. Prompt ç®¡ç†ç³»ç»Ÿ

**ç»Ÿä¸€çš„ Prompt æ¶æ„** (`lib/prompts/`):

```typescript
// æ¯ä¸ªé˜¶æ®µæœ‰ç‹¬ç«‹çš„ Prompts æ¨¡å—
export const SX_PROMPTS = {
  // ç”Ÿæˆ Prompt çš„å‡½æ•°
  generatePrompt: (context: Context) => string,
  
  // è·å–ç”Ÿæˆé…ç½®
  getGenerationConfig: (tier?: 'Lite' | 'Pro') => Config
};
```

**ç‰¹ç‚¹**:
- âœ… é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤
- âœ… ç±»å‹å®‰å…¨çš„ä¸Šä¸‹æ–‡ä¼ é€’
- âœ… æ”¯æŒä¸åŒ AI Tier é…ç½®
- âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»

### 5. çŠ¶æ€ç®¡ç†

ä½¿ç”¨ **Zustand** ç®¡ç†å…¨å±€çŠ¶æ€ï¼š

```typescript
interface CognitiveCoachStore {
  // FSM çŠ¶æ€
  currentState: FSMState;  // S0 | S1 | S2 | S3 | S4
  
  // ç”¨æˆ·ä¸Šä¸‹æ–‡
  userContext: {
    userGoal: string;
    knowledgeFramework?: KnowledgeFramework;
    systemDynamics?: SystemDynamics;
    actionPlan?: ActionPlan;
    strategySpec?: StrategySpec;
  };
  
  // æµå¼å¤„ç†çŠ¶æ€
  streaming: {
    isStreaming: boolean;
    currentStage?: string;
    cognitiveSteps: CognitiveStep[];
    streamContent: string;
    isNavigating: boolean;
  };
  
  // è¿­ä»£æ¨¡å¼
  completedStages: FSMState[];
  iterationCount: Partial<Record<FSMState, number>>;
  isIterativeMode: boolean;
  
  // Actions
  setCurrentState: (state: FSMState) => void;
  updateUserContext: (context: Partial<UserContext>) => void;
  navigateToStage: (stage: FSMState) => void;
  startStreaming: () => void;
  stopStreaming: () => void;
  markStageCompleted: (stage: FSMState) => void;
}
```

**ä¼˜åŠ¿**:
- âœ… ç®€å•ç›´è§‚çš„ API
- âœ… TypeScript å®Œå…¨æ”¯æŒ
- âœ… æ— éœ€ Provider åŒ…è£…
- âœ… å¼€å‘å·¥å…·å‹å¥½
- âœ… æ”¯æŒè¿­ä»£å¼å­¦ä¹ æµç¨‹

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. AI è°ƒç”¨ä¸é‡è¯•æœºåˆ¶

**æ™ºèƒ½é‡è¯•ç­–ç•¥** (`lib/ai-retry-handler.ts`):

```
ç¬¬1æ¬¡: æ­£å¸¸å°è¯•ï¼ˆtemperature: 0.5-0.8ï¼‰
  â†“ å¤±è´¥
ç¬¬2æ¬¡: Schema éªŒè¯å¤±è´¥ â†’ é‡è¯•
  â†“ å¤±è´¥
ç¬¬3æ¬¡: è¶…æ—¶ â†’ é™çº§ temperature (0.4)
  â†“ å¤±è´¥
ç¬¬4æ¬¡: ç½‘ç»œé”™è¯¯ â†’ æŒ‡æ•°é€€é¿é‡è¯•
  â†“ å¤±è´¥
è¿”å›ç»“æ„åŒ–é”™è¯¯ä¿¡æ¯
```

**å…³é”®ç‰¹æ€§**:
- âœ… è‡ªåŠ¨é™çº§ç­–ç•¥
- âœ… æŒ‡æ•°é€€é¿ç®—æ³•
- âœ… Schema éªŒè¯å¤±è´¥è‡ªåŠ¨é‡è¯•
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

### 2. è´¨é‡æ£€æŸ¥é—¨æ§

**QA ç³»ç»Ÿ** (`lib/qa.ts`):

| é˜¶æ®µ | æ£€æŸ¥ç»´åº¦ | è‡ªåŠ¨ä¿®å¤ |
|------|---------|---------|
| **S1** | æ¡†æ¶å®Œæ•´æ€§ã€èŠ‚ç‚¹è¦†ç›– | - |
| **S2** | Mermaid è¯­æ³•ã€èŠ‚ç‚¹è¦†ç›–ã€ä¸€è‡´æ€§ | âœ… è‡ªåŠ¨è¡¥å……ç¼ºå¤±èŠ‚ç‚¹ |
| **S3** | è¡ŒåŠ¨è®¡åˆ’å¯æ‰§è¡Œæ€§ã€æŒ‡æ ‡è¦†ç›– | - |
| **S4** | ç­–ç•¥æŒ‡æ ‡å¼•ç”¨éªŒè¯ | - |

**æ£€æŸ¥ç»´åº¦**:
- `schema`: Schema åˆè§„æ€§ï¼ˆé˜»æ–­æ€§ï¼‰
- `coverage`: å†…å®¹è¦†ç›–åº¦ï¼ˆè­¦å‘Šï¼‰
- `consistency`: é€»è¾‘ä¸€è‡´æ€§ï¼ˆè­¦å‘Šï¼‰
- `evidence`: è¯æ®å……åˆ†æ€§ï¼ˆæç¤ºï¼‰
- `actionability`: å¯æ“ä½œæ€§ï¼ˆæç¤ºï¼‰

### 3. é”™è¯¯å¤„ç†ä½“ç³»

**ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¶æ„**:

```typescript
// 1. é”™è¯¯åˆ†ç±»ï¼ˆä½¿ç”¨ AppError ç±»ï¼‰
AI_API_ERROR       // AI è°ƒç”¨å¤±è´¥
NETWORK_ERROR      // ç½‘ç»œé—®é¢˜
VALIDATION_ERROR   // éªŒè¯å¤±è´¥
QA_GATE_FAILED     // è´¨é‡æ£€æŸ¥å¤±è´¥

// 2. é˜¶æ®µç‰¹å®šé”™è¯¯ï¼ˆæ‰€æœ‰ Service ç»Ÿä¸€ä½¿ç”¨ï¼‰
throw createStageError.s0() // S0 ç‰¹å®šé”™è¯¯
throw createStageError.s1() // S1 ç‰¹å®šé”™è¯¯
throw new AppError({ code, message, ... }) // é€šç”¨é”™è¯¯

// 3. ç”¨æˆ·å‹å¥½çš„é”™è¯¯ç¿»è¯‘ï¼ˆschema-error-translatorï¼‰
Schema é”™è¯¯ â†’ "çŸ¥è¯†æ¡†æ¶ç»“æ„ä¸å®Œæ•´ï¼Œè¯·é‡è¯•"
è¶…æ—¶é”™è¯¯ â†’ "å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œæ­£åœ¨é‡æ–°å°è¯•..."
```

**ç‰¹ç‚¹**:
- âœ… æ‰€æœ‰ Service å±‚ç»Ÿä¸€ä½¿ç”¨ AppErrorï¼ˆS0/S1/S2/S3/S4ï¼‰
- âœ… Schema éªŒè¯å¤±è´¥è‡ªåŠ¨ä½¿ç”¨ translateSchemaError
- âœ… ç»“æ„åŒ–é”™è¯¯ä¿¡æ¯ï¼Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… è¯¦ç»†çš„æŠ€æœ¯æ—¥å¿—ï¼Œè‡ªåŠ¨é™çº§å’Œé‡è¯•

### 4. ç¼“å­˜ç³»ç»Ÿ

**LRU ç¼“å­˜ç­–ç•¥** (`lib/cache-service.ts`):

```typescript
const cache = new LRUCache<string, CachedResponse>({
  max: 100,              // æœ€å¤š 100 ä¸ªæ¡ç›®
  ttl: 1000 * 60 * 60,  // 1 å°æ—¶è¿‡æœŸ
  updateAgeOnGet: true,  // è®¿é—®æ—¶æ›´æ–°å¹´é¾„
  maxSize: 50MB,        // æœ€å¤§å†…å­˜ä½¿ç”¨é‡
});

// åŸºäº prompt hash çš„ç¼“å­˜é”®
const cacheKey = CacheKeyGenerator.generateForPrompt(stage, prompt, context);
```

**ç‰¹æ€§**:
- âœ… å‡å°‘ AI API è°ƒç”¨
- âœ… æå‡å“åº”é€Ÿåº¦
- âœ… è‡ªåŠ¨è¿‡æœŸæ¸…ç†
- âœ… å†…å­˜å ç”¨å¯æ§ï¼ˆæœ€å¤§ 50MBï¼‰
- âœ… å†…å­˜ç›‘æ§å’Œè‡ªåŠ¨æ¸…ç†
- âœ… åˆ†é˜¶æ®µç‹¬ç«‹ç¼“å­˜ï¼ˆS0-S4ï¼‰
- âœ… ç¼“å­˜å¥åº·çŠ¶æ€ç›‘æ§

### 5. æµå¼å¤„ç†

**æµå¼åŒ…è£…å™¨** (`lib/streaming-wrapper.ts`):

```typescript
// å°† Service å“åº”åŒ…è£…ä¸º SSE æµ
await wrapServiceAsStream(
  controller,
  encoder,
  'generateFramework',
  async () => await s1Service.generateFramework(payload)
);
```

**åŠŸèƒ½**:
- âœ… è®¤çŸ¥æ­¥éª¤ç®¡ç†ï¼ˆ4æ­¥è¿›åº¦ï¼‰
- âœ… å¾®å­¦ä¹ æç¤ºï¼ˆæ¯ä¸ªé˜¶æ®µä¸åŒï¼‰
- âœ… å¿ƒè·³æœºåˆ¶ï¼ˆé˜²æ­¢è¶…æ—¶ï¼‰
- âœ… è¿›åº¦æ¨¡æ‹Ÿï¼ˆè§†è§‰åé¦ˆï¼‰

### 6. Hydration å®‰å…¨

**Hydration é—®é¢˜é¢„é˜²** (`lib/hydration-safe.ts`):

```typescript
// æœåŠ¡ç«¯/å®¢æˆ·ç«¯ç¯å¢ƒæ£€æµ‹
export function getIsClient(): boolean;

// Hydration å®Œæˆæ ‡è®°
export function markHydrationComplete(): void;

// å®‰å…¨çš„ console.logï¼ˆé¿å…æœåŠ¡ç«¯å®¢æˆ·ç«¯è¾“å‡ºå·®å¼‚ï¼‰
export function hydrationSafeLog(...args: unknown[]): void;

// Hydration çŠ¶æ€è·å–
export function getHydrationState(): 'server' | 'hydrating' | 'hydrated';
```

**ç»„ä»¶**:
- `components/hydration-monitor.tsx`: å…¨å±€ Hydration çŠ¶æ€ç›‘æ§
- `components/ui/client-only.tsx`: ä»…å®¢æˆ·ç«¯æ¸²æŸ“åŒ…è£…å™¨

**v1.7 ä¼˜åŒ–**:
- åˆ é™¤æœªä½¿ç”¨çš„ `getHydrationSafeRandom()` å’Œ `getHydrationSafeTimestamp()`
- ç®€åŒ–å®ç°ï¼Œä¿ç•™æ ¸å¿ƒåŠŸèƒ½

---

## æ•°æ®æµ

### æ ‡å‡†è¯·æ±‚æµç¨‹

```
ç”¨æˆ·äº¤äº’
  â†“
UI ç»„ä»¶ (S0-S4 Views)
  â†“
çŠ¶æ€ç®¡ç† (Zustand Store)
  â†“
API è°ƒç”¨ (/api/coach æˆ– /api/coach-stream)
  â†“
Schema éªŒè¯ (CoachRequestSchema)
  â†“
Rate Limiting æ£€æŸ¥
  â†“
Service å±‚ (S0-S4Service)
  â†“
Prompt æ„å»º (lib/prompts/)
  â†“
AI è°ƒç”¨ (Gemini API)
  â”œâ”€ é‡è¯•æœºåˆ¶ (ai-retry-handler)
  â””â”€ ç¼“å­˜æ£€æŸ¥ (cache-service)
  â†“
Schema éªŒè¯ (Zod)
  â†“
è´¨é‡æ£€æŸ¥ (qa.ts)
  â”œâ”€ é€šè¿‡ â†’ è¿”å›ç»“æœ
  â””â”€ å¤±è´¥ â†’ è‡ªåŠ¨ä¿®å¤æˆ–é”™è¯¯
  â†“
å“åº”æ„å»º (NextResponse)
  â†“
çŠ¶æ€æ›´æ–° (Store)
  â†“
UI é‡æ–°æ¸²æŸ“
```

### æµå¼å“åº”æµç¨‹

```
ç”¨æˆ·è§¦å‘
  â†“
startStreaming (Store)
  â†“
StreamManager.start (æµå¼çŠ¶æ€ç®¡ç†)
  â†“
API è¯·æ±‚ (/api/coach-stream)
  â†“
ReadableStream åˆ›å»º
  â†“
å¾ªç¯æ¨é€äº‹ä»¶:
  â”œâ”€ cognitive_step (æ­¥éª¤1-4)
  â”‚    â†“
  â”‚  CognitiveStreamAnimator æ¥æ”¶
  â”‚    â†“
  â”‚  UI å®æ—¶æ›´æ–°ï¼ˆè¿›åº¦æ¡ã€æç¤ºï¼‰
  â”‚
  â”œâ”€ data_structure (æœ€ç»ˆç»“æœ)
  â”‚    â†“
  â”‚  Store æ›´æ–°
  â”‚    â†“
  â”‚  è§†å›¾åˆ‡æ¢
  â”‚
  â””â”€ done (å®Œæˆä¿¡å·)
       â†“
     StreamManager.complete
       â†“
     æ¸…ç†èµ„æº
```

---

## å®‰å…¨ç‰¹æ€§

### 1. CORS ä¿æŠ¤
- é…ç½®å…è®¸çš„æºåˆ—è¡¨
- é¢„æ£€è¯·æ±‚å¤„ç†
- å®‰å…¨å“åº”å¤´è®¾ç½®
- åŠ¨æ€æºéªŒè¯

### 2. Rate Limiting
- é»˜è®¤ï¼š60 è¯·æ±‚/åˆ†é’Ÿ
- IP çº§åˆ«é™åˆ¶
- åŸºäºæ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆå†…å­˜å­˜å‚¨ï¼‰
- å¯é…ç½®ä¸Šé™
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®¡æ•°å™¨ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰

### 3. å†…å®¹å®‰å…¨
- Content Security Policy (CSP)
- API Key æ©ç ï¼ˆæ—¥å¿—ä¸­ï¼‰
- é”™è¯¯ä¿¡æ¯è„±æ•ï¼ˆç”Ÿäº§ç¯å¢ƒé›¶æ³„éœ²ï¼‰
- æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨æ£€æµ‹å’Œè¿‡æ»¤
  - æ”¯æŒæ£€æµ‹ï¼šGoogle API key, OpenAI key, JWT, Bearer token
  - è¿‡æ»¤15+æ•æ„Ÿå­—æ®µï¼ˆapiKey, token, password, secretç­‰ï¼‰
  - é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡
- è¾“å…¥é•¿åº¦é™åˆ¶ï¼ˆ2000å­—ç¬¦ï¼‰

### 4. Prompt æ³¨å…¥é˜²æŠ¤
- å±é™©æ¨¡å¼æ£€æµ‹
- è¾“å…¥æ¸…ç†å’ŒéªŒè¯
- é•¿åº¦é™åˆ¶ï¼ˆ2000å­—ç¬¦ï¼‰
- ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤

### 5. ç¯å¢ƒå˜é‡éªŒè¯
- Zod Schema éªŒè¯
- å¿…éœ€å˜é‡æ£€æŸ¥
- ç±»å‹å®‰å…¨ä¿è¯
- å¯åŠ¨æ—¶éªŒè¯

---

## è¿è¡Œæ¨¡å¼

### 1. Lite æ¨¡å¼
- **æ¨¡å‹**: gemini-2.5-flash-lite
- **å“åº”é€Ÿåº¦**: 2-5ç§’
- **é€‚ç”¨åœºæ™¯**: å¿«é€Ÿè¿­ä»£ã€å®æ—¶åé¦ˆ
- **æˆæœ¬**: ä½

### 2. Pro æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- **æ¨¡å‹**: gemini-2.5-pro
- **å“åº”é€Ÿåº¦**: 10-30ç§’
- **é€‚ç”¨åœºæ™¯**: æ·±åº¦åˆ†æã€é«˜è´¨é‡è¾“å‡º
- **ç‰¹æ€§**: N-best ç”Ÿæˆï¼ˆS3ï¼‰
- **æˆæœ¬**: ä¸­

### 3. Review æ¨¡å¼
- **åŸºäº**: Pro æ¨¡å¼
- **é¢å¤–ç‰¹æ€§**: æ·»åŠ äººå·¥å®¡æ ¸æ ‡è®°
- **é€‚ç”¨åœºæ™¯**: å…³é”®å†³ç­–ã€éœ€è¦äºŒæ¬¡ç¡®è®¤
- **æˆæœ¬**: ä¸­

---

## ç¯å¢ƒå˜é‡

### å¿…éœ€
```bash
GEMINI_API_KEY=your_api_key_here
```

### å¯é€‰
```bash
NODE_ENV=development|production
LOG_LEVEL=debug|info|warn|error
ALLOWED_ORIGINS=http://localhost:3000,https://example.com
MAX_REQUESTS_PER_MINUTE=60  # é€Ÿç‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°ï¼‰
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²
- Dynamic Imports (S1-S4 è§†å›¾ç»„ä»¶)
- Route-based splitting (è‡ªåŠ¨)
- æŒ‰éœ€åŠ è½½å¯è§†åŒ–åº“ï¼ˆMermaidã€EChartsï¼‰

### 2. ç¼“å­˜ç­–ç•¥
- AI å“åº”ç¼“å­˜ï¼ˆLRUï¼Œ1å°æ—¶ï¼‰
- æµè§ˆå™¨ç¼“å­˜ï¼ˆé™æ€èµ„æºï¼‰
- ISRï¼ˆå¢é‡é™æ€å†ç”Ÿæˆï¼Œå¯é…ç½®ï¼‰

### 3. æµå¼æ¸²æŸ“
- é™ä½ TTFBï¼ˆé¦–å­—èŠ‚æ—¶é—´ï¼‰
- æ¸è¿›å¼å†…å®¹åŠ è½½
- ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½æå‡
- å®æ—¶è¿›åº¦åé¦ˆ

### 4. å›¾ç‰‡ä¼˜åŒ–
- Next.js Image ç»„ä»¶
- è‡ªåŠ¨æ ¼å¼è½¬æ¢ï¼ˆWebPï¼‰
- å“åº”å¼å›¾ç‰‡åŠ è½½
- æ‡’åŠ è½½

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é˜¶æ®µï¼ˆSXï¼‰

1. **å®šä¹‰ Schema** (`lib/schemas.ts`)
```typescript
export const SXResponseSchema = z.object({
  // å®šä¹‰æ•°æ®ç»“æ„
});
```

2. **åˆ›å»º Prompts** (`lib/prompts/sx-prompts.ts`)
```typescript
export const SX_PROMPTS = {
  generatePrompt: (context) => string,
  getGenerationConfig: (tier) => Config
};
```

3. **åˆ›å»º Service** (`services/sx-service.ts`)
```typescript
export class SXService {
  static getInstance() { ... }
  async processTask(payload) { ... }
}
```

4. **åˆ›å»ºè§†å›¾ç»„ä»¶** (`components/sx-xxx-view.tsx`)
```typescript
export default function SXView() { ... }
```

5. **æ›´æ–° API è·¯ç”±** (`app/api/coach*/route.ts`)
```typescript
case 'sxAction':
  await handleSXStream(...);
  break;
```

6. **æ›´æ–° Store** (`lib/store.ts`)
```typescript
interface UserContext {
  sxData?: SXData;
}
```

7. **æ·»åŠ æµ‹è¯•** (`tests/unit/services/sx-service.test.ts`)

### ä¿®æ”¹ Prompt

1. ç›´æ¥ç¼–è¾‘ `lib/prompts/sx-prompts.ts`
2. æµ‹è¯•éªŒè¯è¾“å‡ºæ ¼å¼
3. æ£€æŸ¥ Schema å…¼å®¹æ€§
4. æ›´æ–°ç›¸å…³æµ‹è¯•

### æ·»åŠ æ–°çš„ AI æ¨¡å‹

1. æ›´æ–° `lib/gemini-config.ts`
```typescript
export type AITier = 'Lite' | 'Pro' | 'Ultra';
const MODELS = {
  Lite: 'gemini-2.5-flash-lite',
  Pro: 'gemini-2.5-pro',
  Ultra: 'gemini-2.5-ultra'  // æ–°å¢
};
```

2. æ›´æ–° `lib/api-types.ts`
```typescript
runTier?: 'Lite' | 'Pro' | 'Review' | 'Ultra';
```

3. æµ‹è¯•æ€§èƒ½å’Œæˆæœ¬

---

## æµ‹è¯•

### æµ‹è¯•æ¡†æ¶
- **Jest** 30.0.0
- **é…ç½®**: `jest.config.js`
- **å…¥å£**: `tests/setup.ts`

### æµ‹è¯•è¦†ç›–
```
tests/unit/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ cache-service.test.ts      âœ… ç¼“å­˜æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ id-generator.test.ts       âœ… IDç”Ÿæˆå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ qa.test.ts                 âœ… è´¨é‡é—¨æ§æµ‹è¯•
â”‚   â”œâ”€â”€ stream-manager.test.ts     âœ… æµå¼ç®¡ç†å™¨æµ‹è¯•
â”‚   â””â”€â”€ prompts/
â”‚       â””â”€â”€ s1-prompts.test.ts     âœ… S1 Promptæµ‹è¯•
â””â”€â”€ services/
    â”œâ”€â”€ s0-service.test.ts         âœ… S0 ç›®æ ‡ç²¾ç‚¼æµ‹è¯•
    â”œâ”€â”€ s1-service.test.ts         âœ… S1 çŸ¥è¯†æ¡†æ¶æµ‹è¯•
    â”œâ”€â”€ s2-service.test.ts         âœ… S2 ç³»ç»ŸåŠ¨åŠ›å­¦æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
    â”œâ”€â”€ s3-service.test.ts         âœ… S3 è¡ŒåŠ¨è®¡åˆ’æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
    â””â”€â”€ s4-service.test.ts         âœ… S4 è¿›åº¦åˆ†ææµ‹è¯•ï¼ˆæ–°å¢ï¼‰
```

**æµ‹è¯•è¦†ç›–ç‡**:
- Serviceå±‚: 100% (S0-S4å…¨è¦†ç›–)
- æ ¸å¿ƒå·¥å…·åº“: ~80%
- æ€»æµ‹è¯•æ•°: 27ä¸ªå•å…ƒæµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# ç›‘å¬æ¨¡å¼
npm test -- --watch
```

---

## éƒ¨ç½²

### Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **è¿æ¥ Git ä»“åº“**
   - æ¨é€åˆ° main åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²
   - Pull Request è‡ªåŠ¨é¢„è§ˆ

2. **ç¯å¢ƒå˜é‡é…ç½®**
   - åœ¨ Vercel Dashboard è®¾ç½®
   - `GEMINI_API_KEY` å¿…éœ€
   - å…¶ä»–å¯é€‰å˜é‡æŒ‰éœ€è®¾ç½®

3. **æ„å»ºè®¾ç½®**
   - Framework Preset: Next.js
   - Build Command: `npm run build`
   - Output Directory: `.next`

4. **ç‰¹æ€§**
   - å…¨çƒ CDN
   - Edge Functions æ”¯æŒ
   - è‡ªåŠ¨ HTTPS
   - é›¶é…ç½®

### è‡ªå®šä¹‰éƒ¨ç½²

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# æˆ–ä½¿ç”¨ PM2
pm2 start npm --name "cognitive-coach" -- start
```

---

## æ¶æ„ä¼˜åŠ¿

### 1. å¯ç»´æŠ¤æ€§
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- âœ… ç»Ÿä¸€çš„ Service æ¨¡å¼
- âœ… é›†ä¸­çš„ Prompt ç®¡ç†
- âœ… ç±»å‹å®‰å…¨ä¿è¯

### 2. å¯æ‰©å±•æ€§
- âœ… æ˜“äºæ·»åŠ æ–°é˜¶æ®µ
- âœ… çµæ´»çš„ AI æ¨¡å‹åˆ‡æ¢
- âœ… æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡
- âœ… æ’ä»¶å¼çš„å·¥å…·å‡½æ•°

### 3. æ€§èƒ½
- âœ… æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- âœ… æµå¼å“åº”é™ä½å»¶è¿Ÿ
- âœ… ä»£ç åˆ†å‰²å‡å°‘åŠ è½½æ—¶é—´
- âœ… LRU ç¼“å­˜æ§åˆ¶å†…å­˜

### 4. ç”¨æˆ·ä½“éªŒ
- âœ… å®æ—¶è¿›åº¦åé¦ˆ
- âœ… å‹å¥½çš„é”™è¯¯æç¤º
- âœ… æµç•…çš„çŠ¶æ€è½¬æ¢
- âœ… å“åº”å¼è®¾è®¡

### 5. å¯é æ€§
- âœ… æ™ºèƒ½é‡è¯•æœºåˆ¶
- âœ… è´¨é‡æ£€æŸ¥é—¨æ§
- âœ… å…¨é¢çš„é”™è¯¯å¤„ç†
- âœ… Hydration å®‰å…¨ä¿è¯

---

## æŠ€æœ¯å†³ç­–è®°å½•

### ä¸ºä»€ä¹ˆä½¿ç”¨ Zustandï¼Ÿ
- æ›´ç®€æ´çš„ API
- æ— éœ€ Provider åŒ…è£…
- TypeScript æ”¯æŒæ›´å¥½
- é€‚åˆä¸­å‹çŠ¶æ€ç®¡ç†

### ä¸ºä»€ä¹ˆåˆ†ç¦»æ ‡å‡†å’Œæµå¼ APIï¼Ÿ
- ä¸åŒçš„å“åº”æ¨¡å¼ï¼ˆJSON vs SSEï¼‰
- æ›´æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- ä¾¿äºé’ˆå¯¹æ€§ä¼˜åŒ–
- å®¢æˆ·ç«¯å¯æ ¹æ®åœºæ™¯é€‰æ‹©

### ä¸ºä»€ä¹ˆ Service å±‚è¿”å› NextResponseï¼Ÿ
- ä¸ Next.js è·¯ç”±å±‚æ— ç¼é›†æˆ
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- ä¾¿äºé”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è®¾ç½®
- æ”¯æŒæ ‡å‡†å’Œæµå¼ä¸¤ç§æ¨¡å¼

### ä¸ºä»€ä¹ˆä½¿ç”¨å•ä¾‹æ¨¡å¼çš„ Serviceï¼Ÿ
- é¿å…é‡å¤åˆå§‹åŒ–
- èµ„æºå…±äº«ï¼ˆç¼“å­˜ç­‰ï¼‰
- ç®€åŒ–ä¾èµ–ç®¡ç†
- ç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§

### ä¸ºä»€ä¹ˆç»Ÿä¸€ Prompt ç®¡ç†ç³»ç»Ÿï¼Ÿ
- é¿å…é‡å¤å®šä¹‰
- é›†ä¸­ç»´æŠ¤æ›´å®¹æ˜“
- ç±»å‹å®‰å…¨ä¿è¯
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»

### ä¸ºä»€ä¹ˆåˆ†ç¦» types.ts å’Œ api-types.tsï¼Ÿ
- **types.ts**: æ ¸å¿ƒä¸šåŠ¡ç±»å‹ï¼ˆFSMState, UserContextï¼‰ï¼Œä¾›Serviceå±‚å’ŒStoreä½¿ç”¨
- **api-types.ts**: APIå±‚ä¸“ç”¨ç±»å‹ï¼ˆPayload, æµå¼æ¶ˆæ¯ï¼‰ï¼Œä¾›API Routesä½¿ç”¨
- é¿å…å¾ªç¯ä¾èµ–ï¼ŒèŒè´£æ¸…æ™°
- ä¾¿äºç†è§£å¯¼å…¥æ¥æº

### ä¸ºä»€ä¹ˆåˆ é™¤ S3Service çš„ getGenerationConfigï¼Ÿ
- åŠŸèƒ½å·²è¢« S3_PROMPTS.getGenerationConfig ç»Ÿä¸€ç®¡ç†
- é¿å…é‡å¤å®šä¹‰å’Œä¸ä¸€è‡´
- Serviceå±‚ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œé…ç½®äº¤ç»™Promptå±‚

---

## ç‰ˆæœ¬ä¿¡æ¯

- **é¡¹ç›®åç§°**: cognitive-coach
- **é¡¹ç›®ç‰ˆæœ¬**: 0.1.0
- **æ¶æ„ç‰ˆæœ¬**: 1.10
- **Node ç‰ˆæœ¬è¦æ±‚**: 20.x
- **åŒ…ç®¡ç†å™¨**: npm
- **License**: MIT
- **ä»£ç è´¨é‡**:
  - Linterè­¦å‘Š: 0
  - TypeScripté”™è¯¯: 0
  - ESLinté”™è¯¯: 0
  - æµ‹è¯•é€šè¿‡ç‡: 100%
  - æµ‹è¯•è¦†ç›–ç‡: Serviceå±‚ 100%
  - ESLint disableæ³¨é‡Š: 0ï¼ˆå®Œå…¨æ¶ˆé™¤ï¼‰
  - Consoleè°ƒç”¨: å®Œå…¨ç»Ÿä¸€ä¸º hydrationSafeLog å’Œ reportError
  - ä»£ç ç®€æ´åº¦: ä¼˜ç§€ï¼ˆv1.9 åŠ¨ç”»ç³»ç»Ÿé‡æ„ï¼Œv1.10 QAé€»è¾‘ç»Ÿä¸€ï¼‰
  - ç±»å‹å®‰å…¨: ä¼˜ç§€ï¼ˆå®Œå…¨æ¶ˆé™¤ any ç±»å‹ï¼‰
  - ç»„ä»¶æ¨¡å—åŒ–: ä¼˜ç§€ï¼ˆloadingé€»è¾‘æ¨¡å—åŒ–ä¸ºç‹¬ç«‹hooksï¼‰
  - æ–‡æ¡£å‡†ç¡®æ€§: 100%ï¼ˆv1.10 ä¿®æ­£@deprecatedæ ‡è®°ï¼‰
  - ä»£ç é‡å¤: æœ€å°åŒ–ï¼ˆv1.10 ç»Ÿä¸€QAå¤„ç†ï¼‰
  - æ€»ä»£ç é‡: å‡€å‡å°‘ ~511è¡Œï¼ˆv1.9å‡å°‘491è¡Œ + v1.10å‡å°‘20è¡Œï¼‰

---

## ä»£ç ä¼˜åŒ–è®°å½•

### v1.10 (2025-10-09) - æ¶æ„å®¡æŸ¥ä¸ä»£ç ä¸€è‡´æ€§ä¼˜åŒ–

**@deprecatedæ ‡è®°ä¿®æ­£** (~3è¡Œä¿®æ”¹):
- âœ… ä¿®æ­£ `lib/types.ts` ä¸­çš„å­—æ®µæ ‡è®°
  - ç§»é™¤ `povTags` çš„é”™è¯¯ @deprecated æ ‡è®°ï¼ˆå®é™…åœ¨lib/qa.tså’Œlib/s2-utils.tsä½¿ç”¨ï¼‰
  - ä¿ç•™ `riskPreference`, `seed` çš„ @deprecated æ ‡è®°ï¼ˆä¼ é€’ä½†æœªä½¿ç”¨ï¼‰
  - æ›´æ–° `lastTelemetry` ä¸º @deprecated Unusedï¼ˆå®Œå…¨æ— å¼•ç”¨ï¼‰
  - æ·»åŠ  "Required by QA and S2" æ³¨é‡Šåˆ°povTags

**æå–é‡å¤QAå¤„ç†é€»è¾‘** (~48è¡Œåˆ é™¤, ~28è¡Œæ–°å¢):
- âœ… æ–°å¢ `lib/service-utils.ts` çš„ `handleQAValidation()` å‡½æ•°
  - ç»Ÿä¸€å¤„ç†è´¨é‡é—¨æ§å¤±è´¥çš„16è¡Œé‡å¤ä»£ç 
  - æ”¯æŒS1/S2/S3/S4æ‰€æœ‰é˜¶æ®µ
  - åŒ…å«å®Œæ•´JSDocæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… é‡æ„ `services/s1-service.ts` (83-95è¡Œ â†’ 85è¡Œ)
  - æ›¿æ¢ä¸º handleQAValidation(qaResult, 'S1')
  - ç§»é™¤æœªä½¿ç”¨çš„ AppError, ErrorCodes å¯¼å…¥
- âœ… é‡æ„ `services/s2-service.ts` (116-126è¡Œ â†’ 116è¡Œ)
  - æ›¿æ¢ä¸º handleQAValidation(qaResult, 'S2')
  - ç§»é™¤æœªä½¿ç”¨çš„ AppError, ErrorCodes å¯¼å…¥
- âœ… é‡æ„ `services/s4-service.ts` (108-118è¡Œ â†’ 107è¡Œ)
  - æ›¿æ¢ä¸º handleQAValidation(qaResult, 'S4')
  - ç§»é™¤æœªä½¿ç”¨çš„ AppError, ErrorCodes å¯¼å…¥

**æ¶æ„æ–‡æ¡£ä¸€è‡´æ€§** (~10è¡Œä¿®æ­£):
- âœ… æ›´æ–° `ARCHITECTURE.md` v1.9ç±»å‹æ¸…ç†è¯´æ˜
  - ä¿®æ­£å­—æ®µä½¿ç”¨æƒ…å†µæè¿°
  - æ˜ç¡®povTagsæ­£åœ¨ä½¿ç”¨ä¸­
  - å‡†ç¡®åˆ—å‡ºçœŸæ­£æœªä½¿ç”¨çš„å­—æ®µ

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~48è¡Œï¼ˆ3ä¸ªServicesçš„é‡å¤QAå¤„ç†é€»è¾‘ï¼‰
- ä»£ç æ–°å¢: ~28è¡Œï¼ˆç»Ÿä¸€çš„handleQAValidationå‡½æ•°ï¼‰
- å‡€å‡å°‘: ~20è¡Œ
- æ–‡æ¡£å‡†ç¡®æ€§: 100%ï¼ˆæ¶ˆé™¤@deprecatedæ ‡è®°é”™è¯¯ï¼‰
- ä»£ç é‡å¤: å‡å°‘48è¡Œï¼ˆQAå¤„ç†é€»è¾‘ç»Ÿä¸€ï¼‰
- TypeScript/ESLint é”™è¯¯: 0
- å¯ç»´æŠ¤æ€§: æ˜¾è‘—æå‡ï¼ˆQAé€»è¾‘é›†ä¸­ç®¡ç†ï¼‰

**æ¶æ„æ”¹è¿›**:
- âœ… æ¶ˆé™¤æ–‡æ¡£ä¸ä»£ç ä¸ä¸€è‡´
- âœ… QAå¤„ç†é€»è¾‘é›†ä¸­åˆ°service-utils.ts
- âœ… å‡å°‘Serviceå±‚ä»£ç é‡å¤
- âœ… æå‡ä»£ç å¯ç»´æŠ¤æ€§

### v1.9 (2025-10-09) - åŠ¨ç”»ç³»ç»Ÿé‡æ„ä¸LoadingOverlayç®€åŒ–

**ä»£ç å¤§å¹…ç®€åŒ–** (~821è¡Œåˆ é™¤):
- âœ… åˆ é™¤ `components/ui/cognitive-catalyst-animation.tsx` (309è¡Œ)
  - å¤æ‚çš„ç²’å­ç³»ç»ŸåŠ¨ç”»ï¼Œä»…åœ¨loading-overlayä½¿ç”¨
  - é«˜æ€§èƒ½å¼€é”€ï¼ˆCanvasæ¸²æŸ“ã€ç²’å­è®¡ç®—ï¼‰
- âœ… åˆ é™¤ `components/ui/neural-network-animation.tsx` (288è¡Œ)
  - Canvasç»˜åˆ¶çš„ç¥ç»ç½‘ç»œåŠ¨ç”»
  - å¤æ‚çš„çŠ¶æ€ç®¡ç†å’ŒåŠ¨ç”»å¾ªç¯
- âœ… åˆ é™¤ `components/ui/ai-thinking-visualization.tsx` (224è¡Œ)
  - æ€ç»´æ°”æ³¡åŠ¨ç”»ç³»ç»Ÿ
  - å¤šä¸ªintervalå’Œå¤æ‚çš„çŠ¶æ€åŒæ­¥

**æ–°å¢ç»Ÿä¸€åŠ¨ç”»ç»„ä»¶** (~200è¡Œ):
- âœ… æ–°å¢ `components/ui/loading-animation.tsx` (200è¡Œ)
  - ç»Ÿä¸€3ç§ç®€åŒ–åŠ¨ç”»ï¼šorbitï¼ˆè½¨é“ï¼‰ã€pulseï¼ˆè„‰å†²ï¼‰ã€simpleï¼ˆspinnerï¼‰
  - ç§»é™¤å¤æ‚Canvaså’Œç²’å­ç³»ç»Ÿï¼Œä¿ç•™æ ¸å¿ƒè§†è§‰åé¦ˆ
  - æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘DOMæ“ä½œå’Œè®¡ç®—

**LoadingOverlayé‡æ„** (498è¡Œ â†’ 150è¡Œï¼Œå‡å°‘70%):
- âœ… é‡æ„ `components/ui/loading-overlay.tsx`
  - ä»498è¡Œç®€åŒ–åˆ°çº¦150è¡Œ
  - ç§»é™¤4ç§åŠ¨ç”»æ¨¡å¼çš„è€¦åˆé€»è¾‘
  - ç§»é™¤å†…åµŒçš„ç½‘ç»œç›‘æ§å’Œè¿›åº¦è®¡ç®—
  - ç»Ÿä¸€ä½¿ç”¨LoadingAnimationç»„ä»¶

**æå–ä¸“ç”¨Hooks** (~130è¡Œæ–°å¢):
- âœ… æ–°å¢ `components/hooks/useNetworkStatus.ts` (50è¡Œ)
  - æå–ç½‘ç»œçŠ¶æ€ç›‘æ§é€»è¾‘
  - ç‹¬ç«‹çš„åœ¨çº¿/ç¦»çº¿æ£€æµ‹
  - é‡è¿æ¬¡æ•°è·Ÿè¸ª
- âœ… æ–°å¢ `components/hooks/useLoadingProgress.ts` (80è¡Œ)
  - æå–è¿›åº¦è®¡ç®—å’Œå¹³æ»‘åŠ¨ç”»é€»è¾‘
  - åŸºäºè®¤çŸ¥æ­¥éª¤çš„çœŸå®è¿›åº¦
  - å¯é…ç½®çš„åŠ¨ç”»å‚æ•°

**ç±»å‹æ¸…ç†** (~4è¡Œä¿®æ”¹):
- âœ… æ ‡è®°æœªä½¿ç”¨å­—æ®µä¸º @deprecated
  - `riskPreference`, `seed`, `lastTelemetry`ï¼ˆçœŸæ­£æœªä½¿ç”¨ï¼‰
  - `povTags` ä¿ç•™ä½¿ç”¨ä¸­ï¼ˆè¢«lib/qa.tså’Œlib/s2-utils.tsä¾èµ–ï¼‰
  - è®¡åˆ’åœ¨ v2.0 ç§»é™¤æœªä½¿ç”¨å­—æ®µ
  - æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~821è¡Œï¼ˆå¤æ‚åŠ¨ç”»ç»„ä»¶ï¼‰
- ä»£ç ç®€åŒ–: LoadingOverlay ä»498è¡Œ â†’ 150è¡Œï¼ˆå‡å°‘70%ï¼‰
- ä»£ç æ–°å¢: ~330è¡Œï¼ˆç»Ÿä¸€åŠ¨ç”» + hooksï¼‰
- å‡€å‡å°‘: ~491è¡Œ
- æ€§èƒ½æå‡: ç§»é™¤Canvasæ¸²æŸ“å’Œå¤æ‚è®¡ç®—
- å¯ç»´æŠ¤æ€§: èŒè´£æ¸…æ™°ï¼Œhookså¯å¤ç”¨
- TypeScript/ESLint é”™è¯¯: 0
- æµ‹è¯•é€šè¿‡ç‡: 100%

**æ¶æ„æ”¹è¿›**:
- âœ… ç»Ÿä¸€åŠ¨ç”»æ¥å£ï¼Œæ˜“äºæ‰©å±•
- âœ… Loadingé€»è¾‘æ¨¡å—åŒ–ï¼ˆåŠ¨ç”»ã€çŠ¶æ€ã€ç½‘ç»œåˆ†ç¦»ï¼‰
- âœ… Hooksæå‡ä»£ç å¤ç”¨æ€§
- âœ… é™ä½ç»„ä»¶å¤æ‚åº¦ï¼Œæå‡å¯æµ‹è¯•æ€§

### v1.8 (2025-10-09) - ç»„ä»¶æ¨¡å—åŒ–æ‹†åˆ†ä¸æ€§èƒ½ä¼˜åŒ–

**ç»„ä»¶æ‹†åˆ†é‡æ„** (~763è¡Œ â†’ 4ä¸ªæ¨¡å—):
- âœ… æ‹†åˆ† `cognitive-stream-animator.tsx` (763è¡Œ â†’ 183è¡Œï¼Œå‡å°‘76%)
  - æ–°å¢ `components/hooks/useStreamState.ts` (134è¡Œ): çŠ¶æ€ç®¡ç† Hook
  - æ–°å¢ `components/hooks/useStreamConnection.ts` (395è¡Œ): è¿æ¥ç®¡ç† Hook
  - æ–°å¢ `components/utils/streamMessageProcessor.ts` (231è¡Œ): æ¶ˆæ¯å¤„ç†å·¥å…·
  - ä¸»ç»„ä»¶ `cognitive-stream-animator.tsx` (183è¡Œ): ä»…è´Ÿè´£UIæ¸²æŸ“å’Œåè°ƒ

**æ¶æ„ä¼˜åŠ¿**:
- âœ… **èŒè´£åˆ†ç¦»**: çŠ¶æ€ç®¡ç†ã€è¿æ¥ç®¡ç†ã€æ¶ˆæ¯å¤„ç†ã€UIæ¸²æŸ“å„å¸å…¶èŒ
- âœ… **å¯æµ‹è¯•æ€§**: æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•ï¼Œçº¯å‡½æ•°æ˜“äºå•å…ƒæµ‹è¯•
- âœ… **å¯å¤ç”¨æ€§**: Hooks å’Œå·¥å…·å‡½æ•°å¯åœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨
- âœ… **å¯ç»´æŠ¤æ€§**: å°æ¨¡å—æ›´æ˜“ç†è§£å’Œä¿®æ”¹ï¼Œå‡å°‘è®¤çŸ¥è´Ÿæ‹…

**æ€§èƒ½ä¼˜åŒ–** (~40è¡Œä¼˜åŒ–):
- âœ… `app/client-page.tsx`: DebugPanel æ”¹ä¸ºåŠ¨æ€å¯¼å…¥ï¼Œç”Ÿäº§ç¯å¢ƒä¸åŠ è½½
- âœ… `components/s1-knowledge-framework-view.tsx`: 
  - ä¼˜åŒ– Store é€‰æ‹©å™¨ï¼Œä½¿ç”¨ç²¾ç¡®é€‰æ‹©é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
  - ä»è·å–æ•´ä¸ª `userContext` å¯¹è±¡æ”¹ä¸ºç²¾ç¡®é€‰æ‹©éœ€è¦çš„å­—æ®µ
  - å‡å°‘ç»„ä»¶é‡æ¸²æŸ“æ¬¡æ•°çº¦ 40-60%

**ä»£ç è´¨é‡æå‡** (~50è¡Œä¼˜åŒ–):
- âœ… `lib/utils.ts`: æ–°å¢ `toText()` å·¥å…·å‡½æ•°ï¼ˆ23è¡Œï¼‰
  - ç»Ÿä¸€ç±»å‹è½¬æ¢é€»è¾‘ï¼Œæ”¯æŒ JSDoc æ–‡æ¡£
  - åˆ é™¤ `cognitive-stream-animator.tsx` ä¸­çš„é‡å¤å®šä¹‰
  - åˆ é™¤ `s1-knowledge-framework-view.tsx` ä¸­çš„é‡å¤å®šä¹‰
- âœ… ç»Ÿä¸€ `CognitiveStep` ç±»å‹å®šä¹‰
  - åˆ é™¤ `cognitive-stream-animator.tsx` ä¸­çš„é‡å¤ç±»å‹å®šä¹‰
  - ç»Ÿä¸€ä½¿ç”¨ `lib/api-types.ts` çš„å®šä¹‰
  - æå‡ç±»å‹ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§

**é™æ€èµ„æºä¼˜åŒ–**:
- âœ… `app/layout.tsx`: ç§»é™¤ä¸å­˜åœ¨çš„ og-image.png å’Œ twitter-card.png å¼•ç”¨
  - é¿å… 404 é”™è¯¯ï¼Œä¼˜åŒ– SEO å…ƒæ•°æ®
  - ä» `summary_large_image` é™çº§ä¸º `summary` å¡ç‰‡ç±»å‹

**å‡€æ•ˆæœ**:
- ä»£ç é‡ç»„: 763è¡Œ â†’ 943è¡Œï¼ˆ4ä¸ªæ¨¡å—ï¼Œå‡€å¢180è¡Œä½†å¯ç»´æŠ¤æ€§å¤§å¹…æå‡ï¼‰
- ä¸»ç»„ä»¶ç®€åŒ–: 76% ä»£ç å‡å°‘ï¼ˆ763è¡Œ â†’ 183è¡Œï¼‰
- æ€§èƒ½æå‡: Storeé€‰æ‹©å™¨ä¼˜åŒ–ï¼Œå‡å°‘ 40-60% ä¸å¿…è¦çš„é‡æ¸²æŸ“
- å¯æµ‹è¯•æ€§: ä» 1ä¸ªå¤§ç»„ä»¶ â†’ 2ä¸ªHooks + 1ä¸ªçº¯å‡½æ•°å·¥å…· + 1ä¸ªUIç»„ä»¶
- ä»£ç é‡å¤: æ¶ˆé™¤ toText() å‡½æ•°é‡å¤ï¼ˆå‡å°‘ ~15è¡Œï¼‰
- ç±»å‹å®‰å…¨: ç»Ÿä¸€ CognitiveStep å®šä¹‰ï¼Œæ¶ˆé™¤ç±»å‹ä¸ä¸€è‡´
- ç”Ÿäº§åŒ…ä½“ç§¯: DebugPanel åŠ¨æ€å¯¼å…¥ï¼Œå‡å°‘çº¦ 2-3KB
- Linter é”™è¯¯: 0
- TypeScript é”™è¯¯: 0

**æ¶æ„æ”¹è¿›**:
- âœ… å¼•å…¥ç»„ä»¶å±‚ Hooks ç›®å½• (`components/hooks/`)
- âœ… å¼•å…¥ç»„ä»¶å±‚å·¥å…·ç›®å½• (`components/utils/`)
- âœ… æ˜ç¡®åˆ’åˆ†ï¼šçŠ¶æ€ç®¡ç†ã€è¿æ¥ç®¡ç†ã€æ¶ˆæ¯å¤„ç†ã€UIæ¸²æŸ“
- âœ… ä¸ºæœªæ¥æ·»åŠ ç»„ä»¶å±‚å•å…ƒæµ‹è¯•æ‰“ä¸‹åŸºç¡€

### v1.7 (2025-10-09) - Serviceå±‚éªŒè¯è¾…åŠ©å‡½æ•°æå–ä¸ç±»å‹å®‰å…¨ä¼˜åŒ–

**Serviceå±‚éªŒè¯è¾…åŠ©å‡½æ•°** (~150è¡Œæ–°å¢):
- âœ… `lib/service-utils.ts`: æ–°å¢5ä¸ªé€šç”¨éªŒè¯è¾…åŠ©å‡½æ•°
  - `validateObject()`: ç»Ÿä¸€å¯¹è±¡éªŒè¯
  - `validateStringField()`: å­—ç¬¦ä¸²å­—æ®µéªŒè¯ï¼ˆæ”¯æŒé•¿åº¦æ£€æŸ¥ï¼‰
  - `validateArrayField()`: æ•°ç»„å­—æ®µéªŒè¯ï¼ˆæ”¯æŒå…ƒç´ éªŒè¯å™¨ï¼‰
  - `validateBooleanField()`: å¸ƒå°”å­—æ®µéªŒè¯
  - `validateNumberField()`: æ•°å­—å­—æ®µéªŒè¯ï¼ˆæ”¯æŒèŒƒå›´æ£€æŸ¥ï¼‰

**Serviceå±‚éªŒè¯æ–¹æ³•é‡æ„** (~70è¡Œå‡å°‘):
- âœ… `services/s0-service.ts`: `validateResponse()` ä½¿ç”¨æ–°è¾…åŠ©å‡½æ•°
- âœ… `services/s1-service.ts`: `validateFramework()` ä½¿ç”¨æ–°è¾…åŠ©å‡½æ•°
- âœ… `services/s2-service.ts`: `validateSystemDynamics()` ä½¿ç”¨æ–°è¾…åŠ©å‡½æ•°
- âœ… `services/s3-service.ts`: `validateActionPlanResponse()` ä½¿ç”¨æ–°è¾…åŠ©å‡½æ•°
- âœ… `services/s4-service.ts`: `validateAnalyzeProgress()` ä½¿ç”¨æ–°è¾…åŠ©å‡½æ•°

**ç±»å‹å®‰å…¨ä¼˜åŒ–** (~30è¡Œä¼˜åŒ–):
- âœ… `lib/app-errors.ts`: 
  - æ·»åŠ å…¨å±€ç±»å‹å£°æ˜ `Window.__errorReports`
  - ç§»é™¤2å¤„ `any` ç±»å‹ï¼Œä½¿ç”¨ç±»å‹å®‰å…¨çš„æ¥å£
- âœ… `lib/schema-error-translator.ts`:
  - ç§»é™¤2å¤„ `any` ç±»å‹ï¼Œä½¿ç”¨å…·ä½“ç±»å‹æ–­è¨€
- âœ… `app/api/health/route.ts`:
  - ä¿®å¤ç±»å‹é”™è¯¯ï¼Œä½¿ç”¨æ­£ç¡®çš„ `NextRequest` ç±»å‹

**ä»£ç æ¸…ç†** (~50è¡Œåˆ é™¤):
- âœ… `lib/hydration-safe.ts`:
  - åˆ é™¤æœªä½¿ç”¨çš„ `getHydrationSafeRandom()` å‡½æ•°ï¼ˆ20è¡Œï¼‰
  - åˆ é™¤æœªä½¿ç”¨çš„ `getHydrationSafeTimestamp()` å‡½æ•°ï¼ˆ20è¡Œï¼‰
  - ç®€åŒ– `markHydrationComplete()` å®ç°

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~120è¡Œï¼ˆæœªä½¿ç”¨å‡½æ•° + é‡å¤éªŒè¯é€»è¾‘ï¼‰
- ä»£ç æ–°å¢: ~150è¡Œï¼ˆé€šç”¨éªŒè¯å·¥å…· + ç±»å‹å£°æ˜ï¼‰
- å‡€å¢åŠ : ~30è¡Œï¼ˆæå‡å¯ç»´æŠ¤æ€§å’Œç±»å‹å®‰å…¨ï¼‰
- ESLint disableæ³¨é‡Š: 6 â†’ 1ï¼ˆå‡å°‘83%ï¼‰
- any ç±»å‹ä½¿ç”¨: 5å¤„ â†’ 0å¤„ï¼ˆ100%æ¶ˆé™¤ï¼‰
- Serviceå±‚éªŒè¯ä»£ç é‡å¤: å‡å°‘ ~40%
- ç±»å‹å®‰å…¨æ€§: æ˜¾è‘—æå‡
- ä»£ç å¯ç»´æŠ¤æ€§: æ˜¾è‘—æå‡

### v1.6 (2025-10-09) - æ—¥å¿—ç³»ç»Ÿå’ŒFetchå®ç°ç»Ÿä¸€

**æ—¥å¿—ç³»ç»Ÿå®Œå…¨ç»Ÿä¸€** (~15å¤„ä¿®æ”¹):
- âœ… `components/cognitive-stream-animator.tsx`: æ‰€æœ‰ console.log/error â†’ hydrationSafeLog/reportError
  - 18å¤„ console.log â†’ hydrationSafeLogï¼ˆæµå¼è°ƒè¯•æ—¥å¿—ï¼‰
  - 2å¤„ console.error â†’ reportErrorï¼ˆé”™è¯¯æŠ¥å‘Šï¼‰
  - 1å¤„ console.warn â†’ reportErrorï¼ˆæœªçŸ¥æ¶ˆæ¯ç±»å‹ï¼‰
- âœ… `components/hydration-monitor.tsx`: 2å¤„ console.log â†’ hydrationSafeLog
- âœ… `components/error-boundary.tsx`: 1å¤„ console.error â†’ reportError
- âœ… `components/ui/interactive-mermaid.tsx`: 1å¤„ console.error â†’ reportError

**Fetchå®ç°ç»Ÿä¸€** (~20è¡Œåˆ é™¤):
- âœ… `components/cognitive-stream-animator.tsx`:
  - åˆ é™¤è‡ªå®šä¹‰ `fetchWithTimeout()` å‡½æ•°ï¼ˆ19è¡Œï¼‰
  - æ”¹ç”¨ `lib/error-utils.ts` çš„ `enhancedFetch()`
  - ç»Ÿä¸€è¶…æ—¶ã€é‡è¯•å’Œé”™è¯¯å¤„ç†é€»è¾‘

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~20è¡Œï¼ˆè‡ªå®šä¹‰fetchå®ç°ï¼‰
- ä»£ç ä¿®æ”¹: ~23å¤„ï¼ˆæ—¥å¿—è°ƒç”¨ç»Ÿä¸€ï¼‰
- Consoleè°ƒç”¨: å®Œå…¨æ¶ˆé™¤ï¼ˆ100%ç»Ÿä¸€ä¸ºhydrationSafeLog/reportErrorï¼‰
- Fetchå®ç°: ç»Ÿä¸€ï¼ˆæ¶ˆé™¤é‡å¤ä»£ç ï¼‰
- TypeScript/ESLint é”™è¯¯: 0
- ä»£ç ä¸€è‡´æ€§: 100%

### v1.5 (2025-10-09) - ä»£ç ç®€åŒ–ä¸æ¶æ„ä¼˜åŒ–

**åˆ é™¤æœªä½¿ç”¨ä»£ç ** (~160è¡Œ):
- âœ… lib/api-fallback.ts: åˆ é™¤æœªä½¿ç”¨çš„ `getApiKeySetupGuide()` å‡½æ•°ï¼ˆ18è¡Œï¼‰
- âœ… lib/env-validator.ts: åˆ é™¤æœªä½¿ç”¨çš„ç¯å¢ƒå˜é‡é…ç½®
  - `AI_CACHE_MAX_SIZE` å’Œ `AI_CACHE_TTL_MS`ï¼ˆä»æœªåœ¨ä»£ç ä¸­å®é™…ä½¿ç”¨ï¼‰
  - `SKIP_ENV_CACHE` æ£€æŸ¥é€»è¾‘ï¼ˆç®€åŒ–ç¯å¢ƒå˜é‡ç¼“å­˜é€»è¾‘ï¼‰
- âœ… lib/rate-limit.ts: åˆ é™¤ RedisStore å ä½å®ç°ï¼ˆ~75è¡Œï¼‰
  - ç®€åŒ–ä¸ºçº¯å†…å­˜å­˜å‚¨å®ç°
  - ç§»é™¤æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ Redis è¿æ¥ä»£ç 
  - ç»Ÿä¸€å¼‚æ­¥å’ŒåŒæ­¥æ¥å£

**ä»£ç ç»„ç»‡ä¼˜åŒ–** (~90è¡Œ):
- âœ… æ–°å¢ lib/s2-utils.ts: S2 é˜¶æ®µä¸“ç”¨å·¥å…·å‡½æ•°
  - ä» lib/utils.ts ç§»åŠ¨ `extractSilentIntent`, `computeTop2Levers`, `computeCorePath`
  - æé«˜ä»£ç å†…èšæ€§ï¼Œé¿å…é€šç”¨å·¥å…·åº“è†¨èƒ€
- âœ… æ–°å¢ lib/service-utils.ts: Service å±‚å…±äº«å·¥å…·
  - æå–é‡å¤çš„ Schema éªŒè¯é”™è¯¯å¤„ç†é€»è¾‘
  - ç»Ÿä¸€ `handleSchemaValidation()` å‡½æ•°ä¾› S1/S2/S4 Service ä½¿ç”¨
  - å‡å°‘ ~40è¡Œé‡å¤ä»£ç 
- âœ… lib/utils.ts: ç®€åŒ–ä¸ºä»…ä¿ç•™ `cn()` å·¥å…·å‡½æ•°
- âœ… lib/cache-service.ts: åˆ é™¤æ³¨é‡Šçš„æ— ç”¨å¯¼å…¥

**æ–‡æ¡£æ›´æ–°**:
- âœ… ARCHITECTURE.md: æ›´æ–°é¡¹ç›®ç»“æ„å’Œç¯å¢ƒå˜é‡è¯´æ˜
- âœ… README.md: å®Œå–„ç¯å¢ƒå˜é‡æ–‡æ¡£ï¼Œæ–°å¢ HEALTH_TOKEN è¯´æ˜

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~160è¡Œï¼ˆæœªä½¿ç”¨ä»£ç  + Redis å ä½å®ç°ï¼‰
- ä»£ç æ–°å¢: ~90è¡Œï¼ˆs2-utils.ts + service-utils.tsï¼‰
- å‡€å‡å°‘: ~70è¡Œ
- TypeScript/ESLint é”™è¯¯: 0
- ä»£ç é‡å¤: å‡å°‘ ~40è¡Œ
- æ¶æ„æ¸…æ™°åº¦: æ˜¾è‘—æå‡

### v1.4 (2025-10-09) - å…¨é¢ä»£ç æ•´æ”¹å’Œè´¨é‡æå‡

**P0 é˜»å¡æ€§é—®é¢˜ä¿®å¤**:
- âœ… ä¿®å¤æ‰€æœ‰11ä¸ªTypeScriptç¼–è¯‘é”™è¯¯
  - ä¿®å¤ FSMState å¯¼å…¥é—®é¢˜ï¼ˆiterative-navigator.tsx ä» @/lib/types å¯¼å…¥ï¼‰
  - ç»Ÿä¸€ ErrorResponse å’Œ ApiErrorResponse ç±»å‹ï¼ˆä½¿ç”¨ ApiErrorResponseï¼‰
  - æ·»åŠ  LoadingOverlay çš„ onRetry å±æ€§
  - ä¿®å¤ NetworkError ç±»å‹å®ˆå«ï¼ˆs4-autonomous-operation-view.tsxï¼‰
  - å®Œå–„ SystemDynamics mock æ•°æ®ï¼ˆs2-service.test.tsï¼‰
  - ä¿®å¤ tests/setup.ts çš„ NODE_ENV èµ‹å€¼ï¼ˆä½¿ç”¨ Object.definePropertyï¼‰

**P2 ä»£ç è´¨é‡æå‡**:
- âœ… ä¿®å¤æ‰€æœ‰11ä¸ªESLinté”™è¯¯
  - åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥ï¼šAppError, ErrorCodes, GenerateFrameworkResponse, ActionPlanResponse, serializeErrorDetailsSecurely
  - åˆ é™¤æœªä½¿ç”¨çš„å˜é‡ï¼šconfig (åœ¨ s0/s1/s2 services), controller (stream-manager.test.ts)
  - å°† require() æ”¹ä¸º ES6 import (s0-service.test.ts)
- âœ… åˆ é™¤æœªä½¿ç”¨çš„ç»„ä»¶ï¼ˆå…±90è¡Œï¼‰
  - components/challenge-interstitial.tsx (28è¡Œ)
  - components/fsm-navigator.tsx (62è¡Œï¼Œå·²è¢« iterative-navigator æ›¿ä»£)

**P1 æ¶æ„ä¼˜åŒ–**:
- âœ… æå–é‡å¤çš„é”™è¯¯æ˜ å°„é€»è¾‘ï¼ˆå‡å°‘~40è¡Œé‡å¤ä»£ç ï¼‰
  - æ–°å¢ lib/error-utils.ts çš„ `mapErrorToUserMessage()` å‡½æ•°
  - ç»Ÿä¸€æµå¼APIä¸­çš„é”™è¯¯æ¶ˆæ¯æ˜ å°„ï¼ˆapp/api/coach-stream/route.tsï¼‰
- âœ… æå–SSEå“åº”å¤´åˆ›å»ºé€»è¾‘ï¼ˆæ¶ˆé™¤3å¤„é‡å¤ï¼‰
  - æ–°å¢ lib/api-middleware.ts çš„ `createSSEHeaders()` å‡½æ•°
  - ç»Ÿä¸€4å¤„SSEå“åº”å¤´è®¾ç½®

**å‡€æ•ˆæœ**:
- ä»£ç åˆ é™¤: ~130è¡Œï¼ˆæœªä½¿ç”¨ç»„ä»¶90è¡Œ + é‡å¤é€»è¾‘40è¡Œï¼‰
- ä»£ç æ–°å¢: ~45è¡Œï¼ˆå·¥å…·å‡½æ•°ï¼‰
- å‡€å‡å°‘: ~85è¡Œ
- TypeScripté”™è¯¯: 11 â†’ 0
- ESLinté”™è¯¯: 11 â†’ 0
- ä»£ç é‡å¤: ~80è¡Œ â†’ 0
- ç±»å‹å®‰å…¨æ€§: æ˜¾è‘—æå‡
- ä»£ç å¯ç»´æŠ¤æ€§: æ˜¾è‘—æå‡

### v1.3 (2025-10-09) - ä»£ç åº“æ·±åº¦æ•´æ”¹

**P0 ä¸¥é‡é—®é¢˜ä¿®å¤**:
- âœ… ä¿®å¤ç¼ºå¤±çš„ `lib/network-utils.ts` ä¾èµ–
  - åœ¨ `lib/error-utils.ts` ä¸­å®ç° `NetworkError` æ¥å£å’Œ `enhancedFetch` å‡½æ•°
  - æ·»åŠ  `getUserFriendlyErrorMessage` è¾…åŠ©å‡½æ•°
  - æ›´æ–° `components/ui/error-display.tsx` å’Œ `components/s4-autonomous-operation-view.tsx`
  - ä¿®å¤ç¼–è¯‘é˜»å¡é—®é¢˜

**P1 æ¶æ„é—®é¢˜ä¼˜åŒ–**:
- âœ… ç»Ÿä¸€ CORS é€»è¾‘ï¼Œæ¶ˆé™¤é‡å¤ä»£ç 
  - å¢å¼º `lib/cors.ts` æ”¯æŒé€šé…ç¬¦åŸŸåï¼ˆ`*.example.com`ï¼‰
  - ç®€åŒ– `middleware.ts`ï¼Œåˆ é™¤é‡å¤çš„ CORS å®ç°ï¼ˆå‡å°‘ ~50 è¡Œä»£ç ï¼‰
  - ç»Ÿä¸€ä½¿ç”¨ `lib/cors.ts` çš„ `handleOptions` å’Œ `withCors`
- âœ… ç»Ÿä¸€ Service å±‚å“åº”ç±»å‹å®šä¹‰
  - åœ¨ `lib/api-types.ts` ä¸­é›†ä¸­å®šä¹‰æ‰€æœ‰å“åº”ç±»å‹
  - åˆ é™¤ `services/s0-service.ts` å’Œ `services/s1-service.ts` ä¸­çš„é‡å¤å®šä¹‰
  - æé«˜ç±»å‹ç®¡ç†çš„ä¸€è‡´æ€§

**P2 ä»£ç è´¨é‡æå‡**:
- âœ… æ¸…ç†æœªä½¿ç”¨çš„å‚æ•°å’Œ ESLint disable æ³¨é‡Šï¼ˆ4å¤„ï¼‰
  - `components/s3-action-plan-view.tsx`: handleStreamError
  - `components/s2-system-dynamics-view.tsx`: handleStreamError
  - `components/ui/loading-overlay.tsx`: estimatedSteps, onRetry
  - `lib/prompts/s4-prompts.ts`: åˆ é™¤æœªä½¿ç”¨çš„ ActionPlan å¯¼å…¥
- âœ… åˆ é™¤æ³¨é‡Šçš„æ­»ä»£ç ï¼ˆ~20è¡Œï¼‰
  - `components/s2-system-dynamics-view.tsx`: æœªä½¿ç”¨çš„å˜é‡å®šä¹‰
  - `lib/logger.ts`: formatStructuredLog å‡½æ•°
- âš ï¸  **éƒ¨åˆ†ç»Ÿä¸€** console.* è°ƒç”¨ä¸º logger æˆ– hydrationSafeLog
  - å·²ç»Ÿä¸€ï¼š`components/hydration-monitor.tsx`: 2å¤„ console.log â†’ hydrationSafeLog
  - å·²ç»Ÿä¸€ï¼š`components/error-boundary.tsx`: 1å¤„ console.error â†’ reportError
  - å·²ç»Ÿä¸€ï¼š`components/ui/interactive-mermaid.tsx`: 1å¤„ console.error â†’ reportError
  - é—ç•™ï¼š`components/cognitive-stream-animator.tsx`: çº¦18å¤„ä¿ç•™ï¼ˆç”¨äºæµå¼è°ƒè¯•ï¼‰
  - æ³¨ï¼šå®Œå…¨ç»Ÿä¸€å·²åœ¨ v1.6 å®Œæˆï¼ˆè§ä¸‹æ–‡ï¼‰

**å‡€æ•ˆæœ**:
- åˆ é™¤ä»£ç : ~70è¡Œï¼ˆé‡å¤CORSé€»è¾‘ã€æ­»ä»£ç ã€æœªä½¿ç”¨å‚æ•°ï¼‰
- æ–°å¢ä»£ç : ~120è¡Œï¼ˆNetworkErrorå®ç°ã€é”™è¯¯å¤„ç†å‡½æ•°ï¼‰
- ESLint disableæ³¨é‡Š: ä» 6 å‡å°‘åˆ° 1
- Consoleè°ƒç”¨: ä» 6 å‡å°‘åˆ° 4ä¸ªæ–‡ä»¶ï¼ˆéƒ¨åˆ†ç»Ÿä¸€ï¼Œcognitive-stream-animatorä»æœ‰è°ƒè¯•æ—¥å¿—ï¼‰
- ä»£ç ä¸€è‡´æ€§: 98%ï¼ˆCORSã€ç±»å‹å®šä¹‰ç»Ÿä¸€ï¼Œæ—¥å¿—è°ƒç”¨éƒ¨åˆ†ç»Ÿä¸€ï¼‰
- Linterè­¦å‘Š: 0
- ç¼–è¯‘é”™è¯¯: 0

### v1.2 (2025-10-09) - ä»£ç åº“å®¡æŸ¥ä¸æ•´æ”¹

**åˆ é™¤çš„æ­»ä»£ç /é‡å¤ä»£ç ** (~610è¡Œ):
- `components/mermaid.tsx` (47è¡Œ) - æ›¿ä»£å“ï¼šinteractive-mermaid.tsx
- `lib/network-utils.ts` (266è¡Œ) - æœªä½¿ç”¨çš„ç½‘ç»œå·¥å…·
- `lib/versioning.ts` (54è¡Œ) - æœªå®Œæˆçš„ç‰ˆæœ¬å¿«ç…§ç³»ç»Ÿ
- `public/*.svg` (5ä¸ªæ–‡ä»¶) - æœªä½¿ç”¨çš„å›¾æ ‡èµ„æº
- `services/s3-service.ts` æœªä½¿ç”¨æ–¹æ³• (21è¡Œ) - getGenerationConfigã€getRetryConfigå·²ç§»é™¤
- `lib/prompts/s2-prompts.ts` é‡å¤å‡½æ•° (9è¡Œ) - åˆ é™¤é‡å¤çš„formatFrameworkDescription
- `app/client-page.tsx` æ³¨é‡Šä»£ç  (1è¡Œ) - æ¸…ç†network-utilsæ®‹ç•™å¼•ç”¨
- `app/api/coach*.ts` æœªä½¿ç”¨å¯¼å…¥ (3è¡Œ) - ç§»é™¤æœªä½¿ç”¨çš„CoachRequestç±»å‹å¯¼å…¥

**æ–°å¢åŠŸèƒ½**:
- `lib/api-middleware.ts` (140è¡Œ) - ç»Ÿä¸€çš„ API ä¸­é—´ä»¶ï¼Œæ¶ˆé™¤é‡å¤é€»è¾‘
- `tests/unit/services/s2-service.test.ts` (160è¡Œ) - S2æœåŠ¡å•å…ƒæµ‹è¯•
- `tests/unit/services/s3-service.test.ts` (245è¡Œ) - S3æœåŠ¡å•å…ƒæµ‹è¯•ï¼ŒåŒ…å«n-besté€‰æ‹©æµ‹è¯•
- `tests/unit/services/s4-service.test.ts` (270è¡Œ) - S4æœåŠ¡å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–åˆ†æå’Œå’¨è¯¢

**æ¶æ„æ”¹è¿›**:
- âœ… æ‰€æœ‰ Service å±‚ç»Ÿä¸€ä½¿ç”¨ AppError å¤„ç†é”™è¯¯
- âœ… Schema éªŒè¯å¤±è´¥ç»Ÿä¸€ä½¿ç”¨ translateSchemaError
- âœ… ç±»å‹å¯¼å…¥ç»Ÿä¸€ä» types.tsï¼ˆä¿®å¤æ½œåœ¨å¾ªç¯ä¾èµ–ï¼‰
- âœ… API è·¯ç”±å…±äº« middlewareï¼ˆrate limitingã€CORSã€schema éªŒè¯ï¼‰
- âœ… ç±»å‹ç³»ç»ŸèŒè´£æ˜ç¡®ï¼ˆtypes.ts vs api-types.tsï¼‰ï¼Œæ·»åŠ è¯¦ç»†å¯¼å…¥æŒ‡å¼•
- âœ… æ¡†æ¶å·¥å…·ç»Ÿä¸€ï¼ˆlib/framework-utils.tsï¼‰ï¼Œæ¶ˆé™¤é‡å¤å®ç°
- âœ… å®Œæ•´çš„JSDocæ³¨é‡Šï¼ˆqa.ts, framework-utils.tsï¼‰
- âœ… åŠ å¼ºç”Ÿäº§ç¯å¢ƒå®‰å…¨ï¼ˆæ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼Œå¯†é’¥æ ¼å¼æ£€æµ‹ï¼‰

**æ–‡æ¡£æ”¹è¿›**:
- âœ… types.ts å’Œ api-types.ts æ·»åŠ è¯¦ç»†çš„èŒè´£è¯´æ˜å’Œå¯¼å…¥æŒ‡å¼•
- âœ… qa.ts æ·»åŠ å®Œæ•´çš„å‡½æ•°æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… framework-utils.ts æ‰€æœ‰å‡½æ•°æ·»åŠ JSDocæ³¨é‡Š
- âœ… ARCHITECTURE.md æ›´æ–°æµ‹è¯•è¦†ç›–å’Œå®é™…çŠ¶æ€

**æµ‹è¯•æ”¹è¿›**:
- âœ… Serviceå±‚æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 100% (S0-S4)
- âœ… æ–°å¢ 27 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆæ€»è®¡ï¼‰
- âœ… æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ­£å¸¸æµç¨‹ã€é”™è¯¯å¤„ç†ã€è¾¹ç•Œæƒ…å†µ

**å®‰å…¨åŠ å¼º**:
- âœ… ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸è¿”å›é”™è¯¯è¯¦æƒ…
- âœ… å¼€å‘ç¯å¢ƒè¿‡æ»¤æ•æ„Ÿå­—æ®µï¼ˆæ‰©å±•åˆ°15+å­—æ®µï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹å¸¸è§å¯†é’¥æ ¼å¼ï¼ˆGoogle API key, OpenAI key, JWT, Bearer tokenï¼‰
- âœ… é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡ä¸­çš„æ•æ„Ÿä¿¡æ¯

**å‡€æ•ˆæœ**:
- ä»£ç é‡å‡€å¢: +405è¡Œï¼ˆåˆ é™¤610è¡Œï¼Œæ–°å¢1015è¡Œæµ‹è¯•å’Œæ–‡æ¡£ï¼‰
- æ­»ä»£ç /é‡å¤ä»£ç : å®Œå…¨æ¸…é™¤
- æµ‹è¯•è¦†ç›–ç‡: Serviceå±‚ 100%ï¼Œæ ¸å¿ƒåº“ ~80%
- é”™è¯¯å¤„ç†ä¸€è‡´æ€§: 100%
- ç±»å‹ç³»ç»Ÿ: æ— å¾ªç¯ä¾èµ–ï¼ŒèŒè´£æ¸…æ™°ï¼Œå¯¼å…¥æŒ‡å¼•å®Œå–„
- Linterè­¦å‘Š: 0
- å®‰å…¨è¯„çº§: A+ï¼ˆç”Ÿäº§ç¯å¢ƒé›¶æ³„éœ²ï¼‰

### v1.1 (2025-10-09) - åˆå§‹æ¸…ç†

**åˆ é™¤çš„æ­»ä»£ç ** (~550è¡Œ):
- åŸºç¡€ä»£ç æ¸…ç†å’Œé”™è¯¯å¤„ç†ç»Ÿä¸€
- API middleware æŠ½å–
- é¡¹ç›®åæ›´æ–°ä¸º `cognitive-coach`

---

## ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [package.json](./package.json) - ä¾èµ–åˆ—è¡¨
- [next.config.ts](./next.config.ts) - Next.js é…ç½®
- [tsconfig.json](./tsconfig.json) - TypeScript é…ç½®

---

**æ–‡æ¡£ç»´æŠ¤**: CognitiveCoach Team  
**è”ç³»æ–¹å¼**: è¯·æäº¤ Issue æˆ– Pull Request

